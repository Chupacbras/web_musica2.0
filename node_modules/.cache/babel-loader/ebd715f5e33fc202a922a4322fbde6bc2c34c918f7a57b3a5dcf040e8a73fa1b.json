{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  encodeMatchers: null,\n  decodeMatchers: null,\n  default: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  encodeMatchers: function () {\n    return encodeMatchers;\n  },\n  decodeMatchers: function () {\n    return decodeMatchers;\n  },\n  default: function () {\n    return middlewareLoader;\n  }\n});\nconst _getmodulebuildinfo = require(\"./get-module-build-info\");\nconst _stringifyrequest = require(\"../stringify-request\");\nconst _constants = require(\"../../../lib/constants\");\nfunction encodeMatchers(matchers) {\n  return Buffer.from(JSON.stringify(matchers)).toString(\"base64\");\n}\nfunction decodeMatchers(encodedMatchers) {\n  return JSON.parse(Buffer.from(encodedMatchers, \"base64\").toString());\n}\nfunction middlewareLoader() {\n  const {\n    absolutePagePath,\n    page,\n    rootDir,\n    matchers: encodedMatchers,\n    preferredRegion,\n    middlewareConfig: middlewareConfigBase64\n  } = this.getOptions();\n  const matchers = encodedMatchers ? decodeMatchers(encodedMatchers) : undefined;\n  const stringifiedPagePath = (0, _stringifyrequest.stringifyRequest)(this, absolutePagePath);\n  const middlewareConfig = JSON.parse(Buffer.from(middlewareConfigBase64, \"base64\").toString());\n  const buildInfo = (0, _getmodulebuildinfo.getModuleBuildInfo)(this._module);\n  buildInfo.nextEdgeMiddleware = {\n    matchers,\n    page: page.replace(new RegExp(`/${_constants.MIDDLEWARE_LOCATION_REGEXP}$`), \"\") || \"/\"\n  };\n  buildInfo.rootDir = rootDir;\n  buildInfo.route = {\n    page,\n    absolutePagePath,\n    preferredRegion,\n    middlewareConfig\n  };\n  return `\n        import 'next/dist/esm/server/web/globals'\n        import { adapter } from 'next/dist/esm/server/web/adapter'\n        import * as _mod from ${stringifiedPagePath}\n\n        const mod = { ..._mod }\n        const handler = mod.middleware || mod.default\n\n        if (typeof handler !== 'function') {\n          throw new Error('The Middleware \"pages${page}\" must export a \\`middleware\\` or a \\`default\\` function');\n        }\n\n        export default function (opts) {\n          return adapter({\n            ...opts,\n            page: ${JSON.stringify(page)},\n            handler,\n          })\n        }\n    `;\n}","map":{"version":3,"names":["encodeMatchers","decodeMatchers","default","middlewareLoader","matchers","Buffer","from","JSON","stringify","toString","encodedMatchers","parse","absolutePagePath","page","rootDir","preferredRegion","middlewareConfig","middlewareConfigBase64","getOptions","undefined","stringifiedPagePath","_stringifyrequest","stringifyRequest","buildInfo","_getmodulebuildinfo","getModuleBuildInfo","_module","nextEdgeMiddleware","replace","RegExp","_constants","MIDDLEWARE_LOCATION_REGEXP","route"],"sources":["../../../../src/build/webpack/loaders/next-middleware-loader.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;EAmBgBA,cAAc,WAAAA,CAAA;WAAdA,cAAA;;EAIAC,cAAc,WAAAA,CAAA;WAAdA,cAAA;;EAMhBC,OAgDC,WAAAA,CAAA;WAhDuBC,gBAAA;;;oCAzBW;kCACF;2BACU;AAapC,SAASH,eAAeI,QAA6B;EAC1D,OAAOC,MAAA,CAAOC,IAAI,CAACC,IAAA,CAAKC,SAAS,CAACJ,QAAA,GAAWK,QAAQ,CAAC;AACxD;AAEO,SAASR,eAAeS,eAAuB;EACpD,OAAOH,IAAA,CAAKI,KAAK,CACfN,MAAA,CAAOC,IAAI,CAACI,eAAA,EAAiB,UAAUD,QAAQ;AAEnD;AAEe,SAASN,iBAAA;EACtB,MAAM;IACJS,gBAAgB;IAChBC,IAAI;IACJC,OAAO;IACPV,QAAA,EAAUM,eAAe;IACzBK,eAAe;IACfC,gBAAA,EAAkBC;EAAsB,CACzC,GAA4B,IAAI,CAACC,UAAU;EAC5C,MAAMd,QAAA,GAAWM,eAAA,GAAkBT,cAAA,CAAeS,eAAA,IAAmBS,SAAA;EACrE,MAAMC,mBAAA,GAAsB,IAAAC,iBAAA,CAAAC,gBAAgB,EAAC,IAAI,EAAEV,gBAAA;EACnD,MAAMI,gBAAA,GAAqCT,IAAA,CAAKI,KAAK,CACnDN,MAAA,CAAOC,IAAI,CAACW,sBAAA,EAAwB,UAAUR,QAAQ;EAExD,MAAMc,SAAA,GAAY,IAAAC,mBAAA,CAAAC,kBAAkB,EAAC,IAAI,CAACC,OAAO;EACjDH,SAAA,CAAUI,kBAAkB,GAAG;IAC7BvB,QAAA;IACAS,IAAA,EACEA,IAAA,CAAKe,OAAO,CAAC,IAAIC,MAAA,CAAQ,IAAGC,UAAA,CAAAC,0BAA2B,GAAE,GAAG,OAAO;EACvE;EACAR,SAAA,CAAUT,OAAO,GAAGA,OAAA;EACpBS,SAAA,CAAUS,KAAK,GAAG;IAChBnB,IAAA;IACAD,gBAAA;IACAG,eAAA;IACAC;EACF;EAEA,OAAQ;;;gCAGsBI,mBAAoB;;;;;;kDAMFP,IAAK;;;;;;oBAMnCN,IAAA,CAAKC,SAAS,CAACK,IAAA,CAAM;;;;KAIpC;AACL"},"metadata":{},"sourceType":"script","externalDependencies":[]}