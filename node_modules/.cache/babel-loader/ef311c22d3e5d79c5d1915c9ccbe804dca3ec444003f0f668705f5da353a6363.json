{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"verifyPartytownSetup\", {\n  enumerable: true,\n  get: function () {\n    return verifyPartytownSetup;\n  }\n});\nconst _fs = require(\"fs\");\nconst _chalk = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/chalk\"));\nconst _path = /*#__PURE__*/_interop_require_default(require(\"path\"));\nconst _hasnecessarydependencies = require(\"./has-necessary-dependencies\");\nconst _fileexists = require(\"./file-exists\");\nconst _fatalerror = require(\"./fatal-error\");\nconst _log = /*#__PURE__*/_interop_require_wildcard(require(\"../build/output/log\"));\nconst _getpkgmanager = require(\"./helpers/get-pkg-manager\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction _getRequireWildcardCache(nodeInterop) {\n  if (typeof WeakMap !== \"function\") return null;\n  var cacheBabelInterop = new WeakMap();\n  var cacheNodeInterop = new WeakMap();\n  return (_getRequireWildcardCache = function (nodeInterop) {\n    return nodeInterop ? cacheNodeInterop : cacheBabelInterop;\n  })(nodeInterop);\n}\nfunction _interop_require_wildcard(obj, nodeInterop) {\n  if (!nodeInterop && obj && obj.__esModule) {\n    return obj;\n  }\n  if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") {\n    return {\n      default: obj\n    };\n  }\n  var cache = _getRequireWildcardCache(nodeInterop);\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n  for (var key in obj) {\n    if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n  newObj.default = obj;\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n  return newObj;\n}\nasync function missingDependencyError(dir) {\n  const packageManager = (0, _getpkgmanager.getPkgManager)(dir);\n  throw new _fatalerror.FatalError(_chalk.default.bold.red(\"It looks like you're trying to use Partytown with next/script but do not have the required package(s) installed.\") + \"\\n\\n\" + _chalk.default.bold(`Please install Partytown by running:`) + \"\\n\\n\" + `\\t${_chalk.default.bold.cyan((packageManager === \"yarn\" ? \"yarn add --dev\" : packageManager === \"pnpm\" ? \"pnpm install --save-dev\" : \"npm install --save-dev\") + \" @builder.io/partytown\")}` + \"\\n\\n\" + _chalk.default.bold(`If you are not trying to use Partytown, please disable the experimental ${_chalk.default.cyan('\"nextScriptWorkers\"')} flag in next.config.js.`) + \"\\n\");\n}\nasync function copyPartytownStaticFiles(deps, staticDir) {\n  const partytownLibDir = _path.default.join(staticDir, \"~partytown\");\n  const hasPartytownLibDir = await (0, _fileexists.fileExists)(partytownLibDir, _fileexists.FileType.Directory);\n  if (hasPartytownLibDir) {\n    await _fs.promises.rm(partytownLibDir, {\n      recursive: true,\n      force: true\n    });\n  }\n  const {\n    copyLibFiles\n  } = await Promise.resolve(require(_path.default.join(deps.resolved.get(\"@builder.io/partytown\"), \"../utils\")));\n  await copyLibFiles(partytownLibDir);\n}\nasync function verifyPartytownSetup(dir, targetDir) {\n  try {\n    var _partytownDeps_missing;\n    const partytownDeps = await (0, _hasnecessarydependencies.hasNecessaryDependencies)(dir, [{\n      file: \"@builder.io/partytown\",\n      pkg: \"@builder.io/partytown\",\n      exportsRestrict: false\n    }]);\n    if (((_partytownDeps_missing = partytownDeps.missing) == null ? void 0 : _partytownDeps_missing.length) > 0) {\n      await missingDependencyError(dir);\n    } else {\n      try {\n        await copyPartytownStaticFiles(partytownDeps, targetDir);\n      } catch (err) {\n        _log.warn(`Partytown library files could not be copied to the static directory. Please ensure that ${_chalk.default.bold.cyan(\"@builder.io/partytown\")} is installed as a dependency.`);\n      }\n    }\n  } catch (err) {\n    // Don't show a stack trace when there is an error due to missing dependencies\n    if (err instanceof _fatalerror.FatalError) {\n      console.error(err.message);\n      process.exit(1);\n    }\n    throw err;\n  }\n}","map":{"version":3,"names":["verifyPartytownSetup","missingDependencyError","dir","packageManager","_getpkgmanager","getPkgManager","_fatalerror","FatalError","_chalk","default","bold","red","cyan","copyPartytownStaticFiles","deps","staticDir","partytownLibDir","_path","join","hasPartytownLibDir","_fileexists","fileExists","FileType","Directory","_fs","promises","rm","recursive","force","copyLibFiles","Promise","resolve","require","resolved","get","targetDir","_partytownDeps_missing","partytownDeps","_hasnecessarydependencies","hasNecessaryDependencies","file","pkg","exportsRestrict","missing","length","err","_log","warn","console","error","message","process","exit"],"sources":["../../src/lib/verify-partytown-setup.ts"],"sourcesContent":[null],"mappings":";;;;;+BA6DsB;;;WAAAA,oBAAA;;;oBA7DG;6DACP;4DAED;0CAIV;4BAC8B;4BACV;4DACN;+BACS;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAE9B,eAAeC,uBAAuBC,GAAW;EAC/C,MAAMC,cAAA,GAAiB,IAAAC,cAAA,CAAAC,aAAa,EAACH,GAAA;EAErC,MAAM,IAAII,WAAA,CAAAC,UAAU,CAClBC,MAAA,CAAAC,OAAK,CAACC,IAAI,CAACC,GAAG,CACZ,sHAEA,SACAH,MAAA,CAAAC,OAAK,CAACC,IAAI,CAAE,sCAAqC,IACjD,SACC,KAAIF,MAAA,CAAAC,OAAK,CAACC,IAAI,CAACE,IAAI,CAClB,CAACT,cAAA,KAAmB,SAChB,mBACAA,cAAA,KAAmB,SACnB,4BACA,wBAAuB,IAAK,yBAChC,EAAC,GACH,SACAK,MAAA,CAAAC,OAAK,CAACC,IAAI,CACP,2EAA0EF,MAAA,CAAAC,OAAK,CAACG,IAAI,CACnF,sBACA,0BAAyB,IAE7B;AAEN;AAEA,eAAeC,yBACbC,IAA2B,EAC3BC,SAAiB;EAEjB,MAAMC,eAAA,GAAkBC,KAAA,CAAAR,OAAI,CAACS,IAAI,CAACH,SAAA,EAAW;EAC7C,MAAMI,kBAAA,GAAqB,MAAM,IAAAC,WAAA,CAAAC,UAAU,EACzCL,eAAA,EACAI,WAAA,CAAAE,QAAQ,CAACC,SAAS;EAGpB,IAAIJ,kBAAA,EAAoB;IACtB,MAAMK,GAAA,CAAAC,QAAQ,CAACC,EAAE,CAACV,eAAA,EAAiB;MAAEW,SAAA,EAAW;MAAMC,KAAA,EAAO;IAAK;EACpE;EAEA,MAAM;IAAEC;EAAY,CAAE,GAAG,MAAMC,OAAA,CAAQC,OAAO,CAC5CC,OAAA,CAAQf,KAAA,CAAAR,OAAI,CAACS,IAAI,CAACJ,IAAA,CAAKmB,QAAQ,CAACC,GAAG,CAAC,0BAA2B;EAGjE,MAAML,YAAA,CAAab,eAAA;AACrB;AAEO,eAAehB,qBACpBE,GAAW,EACXiC,SAAiB;EAEjB,IAAI;QAYEC,sBAAA;IAXJ,MAAMC,aAAA,GAAuC,MAAM,IAAAC,yBAAA,CAAAC,wBAAwB,EACzErC,GAAA,EACA,CACE;MACEsC,IAAA,EAAM;MACNC,GAAA,EAAK;MACLC,eAAA,EAAiB;IACnB,EACD;IAGH,IAAI,EAAAN,sBAAA,GAAAC,aAAA,CAAcM,OAAO,qBAArBP,sBAAA,CAAuBQ,MAAM,IAAG,GAAG;MACrC,MAAM3C,sBAAA,CAAuBC,GAAA;IAC/B,OAAO;MACL,IAAI;QACF,MAAMW,wBAAA,CAAyBwB,aAAA,EAAeF,SAAA;MAChD,EAAE,OAAOU,GAAA,EAAK;QACZC,IAAA,CAAIC,IAAI,CACL,2FAA0FvC,MAAA,CAAAC,OAAK,CAACC,IAAI,CAACE,IAAI,CACxG,wBACA,gCAA+B;MAErC;IACF;EACF,EAAE,OAAOiC,GAAA,EAAK;IACZ;IACA,IAAIA,GAAA,YAAevC,WAAA,CAAAC,UAAU,EAAE;MAC7ByC,OAAA,CAAQC,KAAK,CAACJ,GAAA,CAAIK,OAAO;MACzBC,OAAA,CAAQC,IAAI,CAAC;IACf;IACA,MAAMP,GAAA;EACR;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}