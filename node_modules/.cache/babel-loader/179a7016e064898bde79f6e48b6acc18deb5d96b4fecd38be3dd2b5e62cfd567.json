{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  clearModuleContext: null,\n  deleteAppClientCache: null,\n  deleteCache: null,\n  propagateServerField: null,\n  initialize: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  clearModuleContext: function () {\n    return clearModuleContext;\n  },\n  deleteAppClientCache: function () {\n    return deleteAppClientCache;\n  },\n  deleteCache: function () {\n    return deleteCache;\n  },\n  propagateServerField: function () {\n    return propagateServerField;\n  },\n  initialize: function () {\n    return initialize;\n  }\n});\nconst _next = /*#__PURE__*/_interop_require_default(require(\"../next\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst result = {};\nlet apps = {};\nlet sandboxContext;\nlet requireCacheHotReloader;\nif (process.env.NODE_ENV !== \"production\") {\n  sandboxContext = require(\"../web/sandbox/context\");\n  requireCacheHotReloader = require(\"../../build/webpack/plugins/nextjs-require-cache-hot-reloader\");\n}\nfunction clearModuleContext(target) {\n  return sandboxContext == null ? void 0 : sandboxContext.clearModuleContext(target);\n}\nfunction deleteAppClientCache() {\n  return requireCacheHotReloader == null ? void 0 : requireCacheHotReloader.deleteAppClientCache();\n}\nfunction deleteCache(filePaths) {\n  for (const filePath of filePaths) {\n    requireCacheHotReloader == null ? void 0 : requireCacheHotReloader.deleteCache(filePath);\n  }\n}\nasync function propagateServerField(dir, field, value) {\n  const app = apps[dir];\n  if (!app) {\n    throw new Error(\"Invariant cant propagate server field, no app initialized\");\n  }\n  let appField = app.server;\n  if (appField) {\n    if (typeof appField[field] === \"function\") {\n      await appField[field].apply(app.server, Array.isArray(value) ? value : []);\n    } else {\n      appField[field] = value;\n    }\n  }\n}\nasync function initialize(opts) {\n  // if we already setup the server return as we only need to do\n  // this on first worker boot\n  if (result[opts.dir]) {\n    return result[opts.dir];\n  }\n  const type = process.env.__NEXT_PRIVATE_RENDER_WORKER;\n  if (type) {\n    process.title = \"next-render-worker-\" + type;\n  }\n  let requestHandler;\n  let upgradeHandler;\n  const app = (0, _next.default)({\n    ...opts,\n    _routerWorker: opts.workerType === \"router\",\n    _renderWorker: opts.workerType === \"render\",\n    hostname: opts.hostname || \"localhost\",\n    customServer: false,\n    httpServer: opts.server,\n    port: opts.port,\n    isNodeDebugging: opts.isNodeDebugging\n  });\n  apps[opts.dir] = app;\n  requestHandler = app.getRequestHandler();\n  upgradeHandler = app.getUpgradeHandler();\n  await app.prepare(opts.serverFields);\n  result[opts.dir] = {\n    requestHandler,\n    upgradeHandler\n  };\n  return result[opts.dir];\n}","map":{"version":3,"names":["clearModuleContext","deleteAppClientCache","deleteCache","propagateServerField","initialize","result","apps","sandboxContext","requireCacheHotReloader","process","env","NODE_ENV","require","target","filePaths","filePath","dir","field","value","app","Error","appField","server","apply","Array","isArray","opts","type","__NEXT_PRIVATE_RENDER_WORKER","title","requestHandler","upgradeHandler","_next","default","_routerWorker","workerType","_renderWorker","hostname","customServer","httpServer","port","isNodeDebugging","getRequestHandler","getUpgradeHandler","prepare","serverFields"],"sources":["../../../src/server/lib/render-server.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}