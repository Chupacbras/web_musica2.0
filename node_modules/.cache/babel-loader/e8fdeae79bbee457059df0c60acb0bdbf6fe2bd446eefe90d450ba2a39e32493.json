{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"validateTurboNextConfig\", {\n  enumerable: true,\n  get: function () {\n    return validateTurboNextConfig;\n  }\n});\nconst _path = /*#__PURE__*/_interop_require_default(require(\"path\"));\nconst _config = /*#__PURE__*/_interop_require_default(require(\"../server/config\"));\nconst _constants = require(\"../shared/lib/constants\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst supportedTurbopackNextConfigOptions = [\"configFileName\", \"env\", \"basePath\", \"modularizeImports\", \"compiler.emotion\", \"compiler.relay\", \"compiler.styledComponents\", \"images\", \"pageExtensions\", \"onDemandEntries\", \"rewrites\", \"redirects\", \"headers\", \"reactStrictMode\", \"swcMinify\", \"transpilePackages\", \"trailingSlash\", \"i18n.locales\", \"i18n.defaultLocale\", \"sassOptions\", \"configOrigin\", \"httpAgentOptions\", \"useFileSystemPublicRoutes\", \"generateEtags\", \"assetPrefix\", \"distDir\", \"experimental.serverComponentsExternalPackages\", \"experimental.strictNextHead\", \"experimental.turbo\", \"experimental.mdxRs\", \"experimental.forceSwcTransforms\", \"experimental.serverActionsBodySizeLimit\", \"experimental.memoryBasedWorkersCount\",\n// options below are not really supported, but ignored\n\"webpack\", \"devIndicators\", \"onDemandEntries\", \"excludeDefaultMomentLocales\", \"experimental.cpus\", \"experimental.sharedPool\", \"experimental.proxyTimeout\", \"experimental.isrFlushToDisk\", \"experimental.workerThreads\", \"experimental.caseSensitiveRoutes\", \"experimental.optimizePackageImports\", \"experimental.optimizeServerReact\"];\n// The following will need to be supported by `next build --turbo`\nconst prodSpecificTurboNextConfigOptions = [\"eslint\", \"typescript\", \"staticPageGenerationTimeout\", \"outputFileTracing\", \"output\", \"generateBuildId\", \"analyticsId\", \"compress\", \"productionBrowserSourceMaps\", \"optimizeFonts\", \"poweredByHeader\", \"staticPageGenerationTimeout\", \"reactProductionProfiling\", \"cleanDistDir\", \"compiler.reactRemoveProperties\", \"compiler.removeConsole\", \"experimental.turbotrace\", \"experimental.outputFileTracingRoot\", \"experimental.outputFileTracingExcludes\", \"experimental.outputFileTracingIgnores\", \"experiemental.outputFileTracingIncludes\", \"experimental.gzipSize\", \"experimental.useDeploymentId\", \"experimental.useDeploymentIdServerActions\", \"experimental.deploymentId\", \"experimental.serverMinification\", \"experimental.serverSourceMaps\", \"experimenta.trustHostHeader\"];\nasync function validateTurboNextConfig({\n  dir,\n  isDev\n}) {\n  const {\n    getPkgManager\n  } = require(\"../lib/helpers/get-pkg-manager\");\n  const {\n    getBabelConfigFile\n  } = require(\"../build/get-babel-config-file\");\n  const {\n    defaultConfig\n  } = require(\"../server/config-shared\");\n  const chalk = require(\"next/dist/compiled/chalk\");\n  const {\n    interopDefault\n  } = require(\"../lib/interop-default\");\n  // To regenerate the TURBOPACK gradient require('gradient-string')('blue', 'red')('>>> TURBOPACK')\n  const isTTY = process.stdout.isTTY;\n  const turbopackGradient = `${chalk.bold(isTTY ? \"\\x1b[38;2;0;0;255m>\\x1b[39m\\x1b[38;2;23;0;232m>\\x1b[39m\\x1b[38;2;46;0;209m>\\x1b[39m \\x1b[38;2;70;0;185mT\\x1b[39m\\x1b[38;2;93;0;162mU\\x1b[39m\\x1b[38;2;116;0;139mR\\x1b[39m\\x1b[38;2;139;0;116mB\\x1b[39m\\x1b[38;2;162;0;93mO\\x1b[39m\\x1b[38;2;185;0;70mP\\x1b[39m\\x1b[38;2;209;0;46mA\\x1b[39m\\x1b[38;2;232;0;23mC\\x1b[39m\\x1b[38;2;255;0;0mK\\x1b[39m\" : \">>> TURBOPACK\")} ${chalk.dim(\"(beta)\")}\\n\\n`;\n  let thankYouMessage = [\"Thank you for trying Next.js v13 with Turbopack! As a reminder\", \"Turbopack is currently in beta and not yet ready for production.\", \"We appreciate your ongoing support as we work to make it ready\", \"for everyone.\"].join(\"\\n\") + \"\\n\\n\";\n  let unsupportedParts = \"\";\n  let babelrc = await getBabelConfigFile(dir);\n  if (babelrc) babelrc = _path.default.basename(babelrc);\n  let hasWebpack = false;\n  let hasTurbo = false;\n  let unsupportedConfig = [];\n  let rawNextConfig = {};\n  try {\n    rawNextConfig = interopDefault(await (0, _config.default)(_constants.PHASE_DEVELOPMENT_SERVER, dir, {\n      rawConfig: true\n    }));\n    if (typeof rawNextConfig === \"function\") {\n      rawNextConfig = rawNextConfig(_constants.PHASE_DEVELOPMENT_SERVER, {\n        defaultConfig\n      });\n    }\n    const flattenKeys = (obj, prefix = \"\") => {\n      let keys = [];\n      for (const key in obj) {\n        if (typeof (obj == null ? void 0 : obj[key]) === \"undefined\") {\n          continue;\n        }\n        const pre = prefix.length ? `${prefix}.` : \"\";\n        if (typeof obj[key] === \"object\" && !Array.isArray(obj[key]) && obj[key] !== null) {\n          keys = keys.concat(flattenKeys(obj[key], pre + key));\n        } else {\n          keys.push(pre + key);\n        }\n      }\n      return keys;\n    };\n    const getDeepValue = (obj, keys) => {\n      if (typeof keys === \"string\") {\n        keys = keys.split(\".\");\n      }\n      if (keys.length === 1) {\n        return obj == null ? void 0 : obj[keys == null ? void 0 : keys[0]];\n      }\n      return getDeepValue(obj == null ? void 0 : obj[keys == null ? void 0 : keys[0]], keys.slice(1));\n    };\n    const customKeys = flattenKeys(rawNextConfig);\n    let supportedKeys = isDev ? [...supportedTurbopackNextConfigOptions, ...prodSpecificTurboNextConfigOptions] : supportedTurbopackNextConfigOptions;\n    for (const key of customKeys) {\n      if (key.startsWith(\"webpack\")) {\n        hasWebpack = true;\n      }\n      if (key.startsWith(\"experimental.turbo\")) {\n        hasTurbo = true;\n      }\n      let isSupported = supportedKeys.some(supportedKey => key.startsWith(supportedKey)) || getDeepValue(rawNextConfig, key) === getDeepValue(defaultConfig, key);\n      if (!isSupported) {\n        unsupportedConfig.push(key);\n      }\n    }\n  } catch (e) {\n    console.error(\"Unexpected error occurred while checking config\", e);\n  }\n  const hasWarningOrError = babelrc || unsupportedConfig.length;\n  if (!hasWarningOrError) {\n    thankYouMessage = chalk.dim(thankYouMessage);\n  }\n  console.log(turbopackGradient + thankYouMessage);\n  let feedbackMessage = `Learn more about Next.js v13 and Turbopack: ${chalk.underline(\"https://nextjs.link/with-turbopack\")}\\n`;\n  if (hasWebpack && !hasTurbo) {\n    console.warn(`\\n${chalk.yellow(\"Warning:\")} Webpack is configured while Turbopack is not, which may cause problems.\\n\n  ${`See instructions if you need to configure Turbopack:\\n  https://turbo.build/pack/docs/features/customizing-turbopack\\n`}`);\n  }\n  if (babelrc) {\n    unsupportedParts += `\\n- Babel detected (${chalk.cyan(babelrc)})\\n  Babel is not yet supported. To use Turbopack at the moment,\\n  you'll need to remove your usage of Babel.`;\n  }\n  if (unsupportedConfig.length === 1 && unsupportedConfig[0] === \"experimental.optimizePackageImports\") {\n    console.warn(`\\n${chalk.yellow(\"Warning:\")} ${chalk.cyan(\"experimental.optimizePackageImports\")} is not yet supported by Turbopack and will be ignored.`);\n  } else if (unsupportedConfig.length) {\n    unsupportedParts += `\\n\\n- Unsupported Next.js configuration option(s) (${chalk.cyan(\"next.config.js\")})\\n  To use Turbopack, remove the following configuration options:\\n${unsupportedConfig.map(name => `    - ${chalk.red(name)}\\n`).join(\"\")}`;\n  }\n  if (unsupportedParts) {\n    const pkgManager = getPkgManager(dir);\n    console.error(`Error: You are using configuration and/or tools that are not yet\\nsupported by Next.js v13 with Turbopack:\\n${unsupportedParts}\\n\nIf you cannot make the changes above, but still want to try out\\nNext.js v13 with Turbopack, create the Next.js v13 playground app\\nby running the following commands:\n\n  ${chalk.bold.cyan(`${pkgManager === \"npm\" ? \"npx create-next-app\" : `${pkgManager} create next-app`} --example with-turbopack with-turbopack-app`)}\\n  cd with-turbopack-app\\n  ${pkgManager} run dev\n        `);\n    console.warn(feedbackMessage);\n    process.exit(1);\n  }\n  console.log(feedbackMessage);\n  return rawNextConfig;\n}","map":{"version":3,"names":["validateTurboNextConfig","supportedTurbopackNextConfigOptions","prodSpecificTurboNextConfigOptions","dir","isDev","getPkgManager","require","getBabelConfigFile","defaultConfig","chalk","interopDefault","isTTY","process","stdout","turbopackGradient","bold","dim","thankYouMessage","join","unsupportedParts","babelrc","_path","default","basename","hasWebpack","hasTurbo","unsupportedConfig","rawNextConfig","_config","_constants","PHASE_DEVELOPMENT_SERVER","rawConfig","flattenKeys","obj","prefix","keys","key","pre","length","Array","isArray","concat","push","getDeepValue","split","slice","customKeys","supportedKeys","startsWith","isSupported","some","supportedKey","e","console","error","hasWarningOrError","log","feedbackMessage","underline","warn","yellow","cyan","map","name","red","pkgManager","exit"],"sources":["../../src/lib/turbopack-warning.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}