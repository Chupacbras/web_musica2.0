{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"CssMinimizerPlugin\", {\n  enumerable: true,\n  get: function () {\n    return CssMinimizerPlugin;\n  }\n});\nconst _cssnanosimple = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/cssnano-simple\"));\nconst _postcssscss = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/postcss-scss\"));\nconst _postcss = /*#__PURE__*/_interop_require_default(require(\"postcss\"));\nconst _webpack = require(\"next/dist/compiled/webpack/webpack\");\nconst _profilingplugin = require(\"./profiling-plugin\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n// https://github.com/NMFR/optimize-css-assets-webpack-plugin/blob/0a410a9bf28c7b0e81a3470a13748e68ca2f50aa/src/index.js#L20\nconst CSS_REGEX = /\\.css(\\?.*)?$/i;\nclass CssMinimizerPlugin {\n  constructor(options) {\n    this.__next_css_remove = true;\n    this.options = options;\n  }\n  optimizeAsset(file, asset) {\n    const postcssOptions = {\n      ...this.options.postcssOptions,\n      to: file,\n      from: file,\n      // We don't actually add this parser to support Sass. It can also be used\n      // for inline comment support. See the README:\n      // https://github.com/postcss/postcss-scss/blob/master/README.md#2-inline-comments-for-postcss\n      parser: _postcssscss.default\n    };\n    let input;\n    if (postcssOptions.map && asset.sourceAndMap) {\n      const {\n        source,\n        map\n      } = asset.sourceAndMap();\n      input = source;\n      postcssOptions.map.prev = map ? map : false;\n    } else {\n      input = asset.source();\n    }\n    return (0, _postcss.default)([(0, _cssnanosimple.default)({}, _postcss.default)]).process(input, postcssOptions).then(res => {\n      if (res.map) {\n        return new _webpack.sources.SourceMapSource(res.css, file, res.map.toJSON());\n      } else {\n        return new _webpack.sources.RawSource(res.css);\n      }\n    });\n  }\n  apply(compiler) {\n    compiler.hooks.compilation.tap(\"CssMinimizerPlugin\", compilation => {\n      const cache = compilation.getCache(\"CssMinimizerPlugin\");\n      compilation.hooks.processAssets.tapPromise({\n        name: \"CssMinimizerPlugin\",\n        stage: _webpack.webpack.Compilation.PROCESS_ASSETS_STAGE_OPTIMIZE_SIZE\n      }, async assets => {\n        const compilationSpan = _profilingplugin.spans.get(compilation) || _profilingplugin.spans.get(compiler);\n        const cssMinimizerSpan = compilationSpan.traceChild(\"css-minimizer-plugin\");\n        cssMinimizerSpan.setAttribute(\"webpackVersion\", 5);\n        return cssMinimizerSpan.traceAsyncFn(async () => {\n          const files = Object.keys(assets);\n          await Promise.all(files.filter(file => CSS_REGEX.test(file)).map(async file => {\n            const assetSpan = cssMinimizerSpan.traceChild(\"minify-css\");\n            assetSpan.setAttribute(\"file\", file);\n            return assetSpan.traceAsyncFn(async () => {\n              const asset = assets[file];\n              const etag = cache.getLazyHashedEtag(asset);\n              const cachedResult = await cache.getPromise(file, etag);\n              assetSpan.setAttribute(\"cache\", cachedResult ? \"HIT\" : \"MISS\");\n              if (cachedResult) {\n                assets[file] = cachedResult;\n                return;\n              }\n              const result = await this.optimizeAsset(file, asset);\n              await cache.storePromise(file, etag, result);\n              assets[file] = result;\n            });\n          }));\n        });\n      });\n    });\n  }\n}","map":{"version":3,"names":["CssMinimizerPlugin","CSS_REGEX","constructor","options","__next_css_remove","optimizeAsset","file","asset","postcssOptions","to","from","parser","_postcssscss","default","input","map","sourceAndMap","source","prev","_postcss","_cssnanosimple","process","then","res","_webpack","sources","SourceMapSource","css","toJSON","RawSource","apply","compiler","hooks","compilation","tap","cache","getCache","processAssets","tapPromise","name","stage","webpack","Compilation","PROCESS_ASSETS_STAGE_OPTIMIZE_SIZE","assets","compilationSpan","_profilingplugin","spans","get","cssMinimizerSpan","traceChild","setAttribute","traceAsyncFn","files","Object","keys","Promise","all","filter","test","assetSpan","etag","getLazyHashedEtag","cachedResult","getPromise","result","storePromise"],"sources":["../../../../src/build/webpack/plugins/css-minimizer-plugin.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}