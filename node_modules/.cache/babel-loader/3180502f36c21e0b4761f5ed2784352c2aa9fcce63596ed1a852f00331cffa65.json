{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"sendResponse\", {\n  enumerable: true,\n  get: function () {\n    return sendResponse;\n  }\n});\nconst _pipereadable = require(\"./pipe-readable\");\nconst _utils = require(\"./web/utils\");\nasync function sendResponse(req, res, response) {\n  // Don't use in edge runtime\n  if (process.env.NEXT_RUNTIME !== \"edge\") {\n    var\n    // Copy over the response headers.\n    _response_headers;\n    // Copy over the response status.\n    res.statusCode = response.status;\n    res.statusMessage = response.statusText;\n    (_response_headers = response.headers) == null ? void 0 : _response_headers.forEach((value, name) => {\n      // The append handling is special cased for `set-cookie`.\n      if (name.toLowerCase() === \"set-cookie\") {\n        // TODO: (wyattjoh) replace with native response iteration when we can upgrade undici\n        for (const cookie of (0, _utils.splitCookiesString)(value)) {\n          res.appendHeader(name, cookie);\n        }\n      } else {\n        res.appendHeader(name, value);\n      }\n    });\n    /**\n    * The response can't be directly piped to the underlying response. The\n    * following is duplicated from the edge runtime handler.\n    *\n    * See packages/next/server/next-server.ts\n    */\n    const originalResponse = res.originalResponse;\n    // A response body must not be sent for HEAD requests. See https://httpwg.org/specs/rfc9110.html#HEAD\n    if (response.body && req.method !== \"HEAD\") {\n      await (0, _pipereadable.pipeReadable)(response.body, originalResponse);\n    } else {\n      originalResponse.end();\n    }\n  }\n}","map":{"version":3,"names":["sendResponse","req","res","response","process","env","NEXT_RUNTIME","_response_headers","statusCode","status","statusMessage","statusText","headers","forEach","value","name","toLowerCase","cookie","_utils","splitCookiesString","appendHeader","originalResponse","body","method","_pipereadable","pipeReadable","end"],"sources":["../../src/server/send-response.ts"],"sourcesContent":[null],"mappings":";;;;;+BAYsB;;;WAAAA,YAAA;;;8BAVO;uBACM;AAS5B,eAAeA,aACpBC,GAAoB,EACpBC,GAAqB,EACrBC,QAAkB;EAElB;EACA,IAAIC,OAAA,CAAQC,GAAG,CAACC,YAAY,KAAK,QAAQ;;IAKvC;IACAC,iBAAA;IALA;IACAL,GAAA,CAAIM,UAAU,GAAGL,QAAA,CAASM,MAAM;IAChCP,GAAA,CAAIQ,aAAa,GAAGP,QAAA,CAASQ,UAAU;KAGvCJ,iBAAA,GAAAJ,QAAA,CAASS,OAAO,qBAAhBL,iBAAA,CAAkBM,OAAO,CAAC,CAACC,KAAA,EAAOC,IAAA;MAChC;MACA,IAAIA,IAAA,CAAKC,WAAW,OAAO,cAAc;QACvC;QACA,KAAK,MAAMC,MAAA,IAAU,IAAAC,MAAA,CAAAC,kBAAkB,EAACL,KAAA,GAAQ;UAC9CZ,GAAA,CAAIkB,YAAY,CAACL,IAAA,EAAME,MAAA;QACzB;MACF,OAAO;QACLf,GAAA,CAAIkB,YAAY,CAACL,IAAA,EAAMD,KAAA;MACzB;IACF;IAEA;;;;;;IAOA,MAAMO,gBAAA,GAAmBnB,GAAC,CAAyBmB,gBAAgB;IAEnE;IACA,IAAIlB,QAAA,CAASmB,IAAI,IAAIrB,GAAA,CAAIsB,MAAM,KAAK,QAAQ;MAC1C,MAAM,IAAAC,aAAA,CAAAC,YAAY,EAACtB,QAAA,CAASmB,IAAI,EAAED,gBAAA;IACpC,OAAO;MACLA,gBAAA,CAAiBK,GAAG;IACtB;EACF;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}