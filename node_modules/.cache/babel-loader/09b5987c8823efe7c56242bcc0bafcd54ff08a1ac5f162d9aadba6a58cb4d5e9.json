{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  formatModuleTrace: null,\n  getModuleTrace: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  formatModuleTrace: function () {\n    return formatModuleTrace;\n  },\n  getModuleTrace: function () {\n    return getModuleTrace;\n  }\n});\nconst _loaderutils3 = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/loader-utils3\"));\nconst _path = require(\"path\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction formatModule(compiler, module1) {\n  const relativePath = (0, _path.relative)(compiler.context, module1.resource).replace(/\\?.+$/, \"\");\n  return _loaderutils3.default.isUrlRequest(relativePath) ? _loaderutils3.default.urlToRequest(relativePath) : relativePath;\n}\nfunction formatModuleTrace(compiler, moduleTrace) {\n  let importTrace = [];\n  let firstExternalModule;\n  for (let i = moduleTrace.length - 1; i >= 0; i--) {\n    const mod = moduleTrace[i];\n    if (!mod.resource) continue;\n    if (!mod.resource.includes(\"node_modules/\")) {\n      importTrace.unshift(formatModule(compiler, mod));\n    } else {\n      firstExternalModule = mod;\n      break;\n    }\n  }\n  let invalidImportMessage = \"\";\n  if (firstExternalModule) {\n    var _firstExternalModule_resourceResolveData_descriptionFileData, _firstExternalModule_resourceResolveData;\n    const firstExternalPackageName = (_firstExternalModule_resourceResolveData = firstExternalModule.resourceResolveData) == null ? void 0 : (_firstExternalModule_resourceResolveData_descriptionFileData = _firstExternalModule_resourceResolveData.descriptionFileData) == null ? void 0 : _firstExternalModule_resourceResolveData_descriptionFileData.name;\n    if (firstExternalPackageName === \"styled-jsx\") {\n      invalidImportMessage += `\\n\\nThe error was caused by using 'styled-jsx' in '${importTrace[0]}'. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.`;\n    } else {\n      let formattedExternalFile = firstExternalModule.resource.split(\"node_modules\");\n      formattedExternalFile = formattedExternalFile[formattedExternalFile.length - 1];\n      invalidImportMessage += `\\n\\nThe error was caused by importing '${formattedExternalFile.slice(1)}' in '${importTrace[0]}'.`;\n    }\n  }\n  return {\n    lastInternalFileName: importTrace[0],\n    invalidImportMessage,\n    formattedModuleTrace: `${importTrace.map(mod => \"  \" + mod).join(\"\\n\")}`\n  };\n}\nfunction getModuleTrace(module1, compilation, compiler) {\n  // Get the module trace:\n  // https://cs.github.com/webpack/webpack/blob/9fcaa243573005d6fdece9a3f8d89a0e8b399613/lib/stats/DefaultStatsFactoryPlugin.js#L414\n  const visitedModules = new Set();\n  const moduleTrace = [];\n  let current = module1;\n  let isPagesDir = false;\n  while (current) {\n    if (visitedModules.has(current)) break;\n    if (/[\\\\/]pages/.test(current.resource.replace(compiler.context, \"\"))) {\n      isPagesDir = true;\n    }\n    visitedModules.add(current);\n    moduleTrace.push(current);\n    const origin = compilation.moduleGraph.getIssuer(current);\n    if (!origin) break;\n    current = origin;\n  }\n  return {\n    moduleTrace,\n    isPagesDir\n  };\n}","map":{"version":3,"names":["formatModuleTrace","getModuleTrace","formatModule","compiler","module1","relativePath","_path","relative","context","resource","replace","_loaderutils3","default","isUrlRequest","urlToRequest","moduleTrace","importTrace","firstExternalModule","i","length","mod","includes","unshift","invalidImportMessage","_firstExternalModule_resourceResolveData_descriptionFileData","_firstExternalModule_resourceResolveData","firstExternalPackageName","resourceResolveData","descriptionFileData","name","formattedExternalFile","split","slice","lastInternalFileName","formattedModuleTrace","map","join","compilation","visitedModules","Set","current","isPagesDir","has","test","add","push","origin","moduleGraph","getIssuer"],"sources":["../../../../../src/build/webpack/plugins/wellknown-errors-plugin/getModuleTrace.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}