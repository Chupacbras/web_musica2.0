{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"acceptLanguage\", {\n  enumerable: true,\n  get: function () {\n    return acceptLanguage;\n  }\n});\nfunction parse(raw, preferences, options) {\n  const lowers = new Map();\n  const header = raw.replace(/[ \\t]/g, \"\");\n  if (preferences) {\n    let pos = 0;\n    for (const preference of preferences) {\n      const lower = preference.toLowerCase();\n      lowers.set(lower, {\n        orig: preference,\n        pos: pos++\n      });\n      if (options.prefixMatch) {\n        const parts = lower.split(\"-\");\n        while (parts.pop(), parts.length > 0) {\n          const joined = parts.join(\"-\");\n          if (!lowers.has(joined)) {\n            lowers.set(joined, {\n              orig: preference,\n              pos: pos++\n            });\n          }\n        }\n      }\n    }\n  }\n  const parts = header.split(\",\");\n  const selections = [];\n  const map = new Set();\n  for (let i = 0; i < parts.length; ++i) {\n    const part = parts[i];\n    if (!part) {\n      continue;\n    }\n    const params = part.split(\";\");\n    if (params.length > 2) {\n      throw new Error(`Invalid ${options.type} header`);\n    }\n    let token = params[0].toLowerCase();\n    if (!token) {\n      throw new Error(`Invalid ${options.type} header`);\n    }\n    const selection = {\n      token,\n      pos: i,\n      q: 1\n    };\n    if (preferences && lowers.has(token)) {\n      selection.pref = lowers.get(token).pos;\n    }\n    map.add(selection.token);\n    if (params.length === 2) {\n      const q = params[1];\n      const [key, value] = q.split(\"=\");\n      if (!value || key !== \"q\" && key !== \"Q\") {\n        throw new Error(`Invalid ${options.type} header`);\n      }\n      const score = parseFloat(value);\n      if (score === 0) {\n        continue;\n      }\n      if (Number.isFinite(score) && score <= 1 && score >= 0.001) {\n        selection.q = score;\n      }\n    }\n    selections.push(selection);\n  }\n  selections.sort((a, b) => {\n    if (b.q !== a.q) {\n      return b.q - a.q;\n    }\n    if (b.pref !== a.pref) {\n      if (a.pref === undefined) {\n        return 1;\n      }\n      if (b.pref === undefined) {\n        return -1;\n      }\n      return a.pref - b.pref;\n    }\n    return a.pos - b.pos;\n  });\n  const values = selections.map(selection => selection.token);\n  if (!preferences || !preferences.length) {\n    return values;\n  }\n  const preferred = [];\n  for (const selection of values) {\n    if (selection === \"*\") {\n      for (const [preference, value] of lowers) {\n        if (!map.has(preference)) {\n          preferred.push(value.orig);\n        }\n      }\n    } else {\n      const lower = selection.toLowerCase();\n      if (lowers.has(lower)) {\n        preferred.push(lowers.get(lower).orig);\n      }\n    }\n  }\n  return preferred;\n}\nfunction acceptLanguage(header = \"\", preferences) {\n  return parse(header, preferences, {\n    type: \"accept-language\",\n    prefixMatch: true\n  })[0] || \"\";\n}","map":{"version":3,"names":["acceptLanguage","parse","raw","preferences","options","lowers","Map","header","replace","pos","preference","lower","toLowerCase","set","orig","prefixMatch","parts","split","pop","length","joined","join","has","selections","map","Set","i","part","params","Error","type","token","selection","q","pref","get","add","key","value","score","parseFloat","Number","isFinite","push","sort","a","b","undefined","values","preferred"],"sources":["../../src/server/accept-header.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}