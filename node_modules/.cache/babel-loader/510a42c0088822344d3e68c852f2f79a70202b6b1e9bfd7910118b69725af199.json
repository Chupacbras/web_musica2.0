{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"AppBuildManifestPlugin\", {\n  enumerable: true,\n  get: function () {\n    return AppBuildManifestPlugin;\n  }\n});\nconst _webpack = require(\"next/dist/compiled/webpack/webpack\");\nconst _constants = require(\"../../../shared/lib/constants\");\nconst _buildmanifestplugin = require(\"./build-manifest-plugin\");\nconst _getapproutefromentrypoint = /*#__PURE__*/_interop_require_default(require(\"../../../server/get-app-route-from-entrypoint\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst PLUGIN_NAME = \"AppBuildManifestPlugin\";\nclass AppBuildManifestPlugin {\n  constructor(options) {\n    this.dev = options.dev;\n  }\n  apply(compiler) {\n    compiler.hooks.compilation.tap(PLUGIN_NAME, (compilation, {\n      normalModuleFactory\n    }) => {\n      compilation.dependencyFactories.set(_webpack.webpack.dependencies.ModuleDependency, normalModuleFactory);\n      compilation.dependencyTemplates.set(_webpack.webpack.dependencies.ModuleDependency, new _webpack.webpack.dependencies.NullDependency.Template());\n    });\n    compiler.hooks.make.tap(PLUGIN_NAME, compilation => {\n      compilation.hooks.processAssets.tap({\n        name: PLUGIN_NAME,\n        stage: _webpack.webpack.Compilation.PROCESS_ASSETS_STAGE_ADDITIONS\n      }, assets => this.createAsset(assets, compilation));\n    });\n  }\n  createAsset(assets, compilation) {\n    const manifest = {\n      pages: {}\n    };\n    const mainFiles = new Set((0, _buildmanifestplugin.getEntrypointFiles)(compilation.entrypoints.get(_constants.CLIENT_STATIC_FILES_RUNTIME_MAIN_APP)));\n    for (const entrypoint of compilation.entrypoints.values()) {\n      if (!entrypoint.name) {\n        continue;\n      }\n      if (_constants.SYSTEM_ENTRYPOINTS.has(entrypoint.name)) {\n        continue;\n      }\n      const pagePath = (0, _getapproutefromentrypoint.default)(entrypoint.name);\n      if (!pagePath) {\n        continue;\n      }\n      const filesForPage = (0, _buildmanifestplugin.getEntrypointFiles)(entrypoint);\n      manifest.pages[pagePath] = [...new Set([...mainFiles, ...filesForPage])];\n    }\n    const json = JSON.stringify(manifest, null, 2);\n    assets[_constants.APP_BUILD_MANIFEST] = new _webpack.sources.RawSource(json);\n  }\n}","map":{"version":3,"names":["AppBuildManifestPlugin","PLUGIN_NAME","constructor","options","dev","apply","compiler","hooks","compilation","tap","normalModuleFactory","dependencyFactories","set","_webpack","webpack","dependencies","ModuleDependency","dependencyTemplates","NullDependency","Template","make","processAssets","name","stage","Compilation","PROCESS_ASSETS_STAGE_ADDITIONS","assets","createAsset","manifest","pages","mainFiles","Set","_buildmanifestplugin","getEntrypointFiles","entrypoints","get","_constants","CLIENT_STATIC_FILES_RUNTIME_MAIN_APP","entrypoint","values","SYSTEM_ENTRYPOINTS","has","pagePath","_getapproutefromentrypoint","default","filesForPage","json","JSON","stringify","APP_BUILD_MANIFEST","sources","RawSource"],"sources":["../../../../src/build/webpack/plugins/app-build-manifest-plugin.ts"],"sourcesContent":[null],"mappings":";;;;;+BAmBa;;;WAAAA,sBAAA;;;yBAnBoB;2BAK1B;qCAC4B;iFACG;;;;;;AAUtC,MAAMC,WAAA,GAAc;AAEb,MAAMD,sBAAA;EAGXE,YAAYC,OAAgB,EAAE;IAC5B,IAAI,CAACC,GAAG,GAAGD,OAAA,CAAQC,GAAG;EACxB;EAEOC,MAAMC,QAAa,EAAE;IAC1BA,QAAA,CAASC,KAAK,CAACC,WAAW,CAACC,GAAG,CAC5BR,WAAA,EACA,CAACO,WAAA,EAAkB;MAAEE;IAAmB,CAAO;MAC7CF,WAAA,CAAYG,mBAAmB,CAACC,GAAG,CACjCC,QAAA,CAAAC,OAAO,CAACC,YAAY,CAACC,gBAAgB,EACrCN,mBAAA;MAEFF,WAAA,CAAYS,mBAAmB,CAACL,GAAG,CACjCC,QAAA,CAAAC,OAAO,CAACC,YAAY,CAACC,gBAAgB,EACrC,IAAIH,QAAA,CAAAC,OAAO,CAACC,YAAY,CAACG,cAAc,CAACC,QAAQ;IAEpD;IAGFb,QAAA,CAASC,KAAK,CAACa,IAAI,CAACX,GAAG,CAACR,WAAA,EAAcO,WAAA;MACpCA,WAAA,CAAYD,KAAK,CAACc,aAAa,CAACZ,GAAG,CACjC;QACEa,IAAA,EAAMrB,WAAA;QACNsB,KAAA,EAAOV,QAAA,CAAAC,OAAO,CAACU,WAAW,CAACC;MAC7B,GACCC,MAAA,IAAgB,IAAI,CAACC,WAAW,CAACD,MAAA,EAAQlB,WAAA;IAE9C;EACF;EAEQmB,YAAYD,MAAW,EAAElB,WAAgC,EAAE;IACjE,MAAMoB,QAAA,GAA6B;MACjCC,KAAA,EAAO,CAAC;IACV;IAEA,MAAMC,SAAA,GAAY,IAAIC,GAAA,CACpB,IAAAC,oBAAA,CAAAC,kBAAkB,EAChBzB,WAAA,CAAY0B,WAAW,CAACC,GAAG,CAACC,UAAA,CAAAC,oCAAoC;IAIpE,KAAK,MAAMC,UAAA,IAAc9B,WAAA,CAAY0B,WAAW,CAACK,MAAM,IAAI;MACzD,IAAI,CAACD,UAAA,CAAWhB,IAAI,EAAE;QACpB;MACF;MAEA,IAAIc,UAAA,CAAAI,kBAAkB,CAACC,GAAG,CAACH,UAAA,CAAWhB,IAAI,GAAG;QAC3C;MACF;MAEA,MAAMoB,QAAA,GAAW,IAAAC,0BAAA,CAAAC,OAAyB,EAACN,UAAA,CAAWhB,IAAI;MAC1D,IAAI,CAACoB,QAAA,EAAU;QACb;MACF;MAEA,MAAMG,YAAA,GAAe,IAAAb,oBAAA,CAAAC,kBAAkB,EAACK,UAAA;MACxCV,QAAA,CAASC,KAAK,CAACa,QAAA,CAAS,GAAG,C,GAAI,IAAIX,GAAA,CAAI,C,GAAID,SAAA,E,GAAce,YAAA,CAAa,EAAE;IAC1E;IAEA,MAAMC,IAAA,GAAOC,IAAA,CAAKC,SAAS,CAACpB,QAAA,EAAU,MAAM;IAE5CF,MAAM,CAACU,UAAA,CAAAa,kBAAkB,CAAC,GAAG,IAAIpC,QAAA,CAAAqC,OAAO,CAACC,SAAS,CAACL,IAAA;EACrD;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}