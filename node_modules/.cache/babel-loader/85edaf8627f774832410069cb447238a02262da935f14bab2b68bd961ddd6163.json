{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"install\", {\n  enumerable: true,\n  get: function () {\n    return install;\n  }\n});\nconst _chalk = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/chalk\"));\nconst _crossspawn = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/cross-spawn\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction install(root, dependencies, {\n  packageManager,\n  isOnline,\n  devDependencies\n}) {\n  /**\n  * (p)npm-specific command-line flags.\n  */\n  const npmFlags = [];\n  /**\n  * Yarn-specific command-line flags.\n  */\n  const yarnFlags = [];\n  /**\n  * Return a Promise that resolves once the installation is finished.\n  */\n  return new Promise((resolve, reject) => {\n    let args;\n    let command = packageManager;\n    const useYarn = packageManager === \"yarn\";\n    if (dependencies && dependencies.length) {\n      /**\n      * If there are dependencies, run a variation of `{packageManager} add`.\n      */\n      if (useYarn) {\n        /**\n        * Call `yarn add --exact (--offline)? (-D)? ...`.\n        */\n        args = [\"add\", \"--exact\"];\n        if (!isOnline) args.push(\"--offline\");\n        args.push(\"--cwd\", root);\n        if (devDependencies) args.push(\"--dev\");\n        args.push(...dependencies);\n      } else {\n        /**\n        * Call `(p)npm install [--save|--save-dev] ...`.\n        */\n        args = [\"install\", \"--save-exact\"];\n        args.push(devDependencies ? \"--save-dev\" : \"--save\");\n        args.push(...dependencies);\n      }\n    } else {\n      /**\n      * If there are no dependencies, run a variation of `{packageManager}\n      * install`.\n      */\n      args = [\"install\"];\n      if (!isOnline) {\n        console.log(_chalk.default.yellow(\"You appear to be offline.\"));\n        if (useYarn) {\n          console.log(_chalk.default.yellow(\"Falling back to the local Yarn cache.\"));\n          console.log();\n          args.push(\"--offline\");\n        } else {\n          console.log();\n        }\n      }\n    }\n    /**\n    * Add any package manager-specific flags.\n    */\n    if (useYarn) {\n      args.push(...yarnFlags);\n    } else {\n      args.push(...npmFlags);\n    }\n    /**\n    * Spawn the installation process.\n    */\n    const child = (0, _crossspawn.default)(command, args, {\n      stdio: \"inherit\",\n      env: {\n        ...process.env,\n        ADBLOCK: \"1\",\n        // we set NODE_ENV to development as pnpm skips dev\n        // dependencies when production\n        NODE_ENV: \"development\",\n        DISABLE_OPENCOLLECTIVE: \"1\"\n      }\n    });\n    child.on(\"close\", code => {\n      if (code !== 0) {\n        reject({\n          command: `${command} ${args.join(\" \")}`\n        });\n        return;\n      }\n      resolve();\n    });\n  });\n}","map":{"version":3,"names":["install","root","dependencies","packageManager","isOnline","devDependencies","npmFlags","yarnFlags","Promise","resolve","reject","args","command","useYarn","length","push","console","log","_chalk","default","yellow","child","_crossspawn","stdio","env","process","ADBLOCK","NODE_ENV","DISABLE_OPENCOLLECTIVE","on","code","join"],"sources":["../../../src/lib/helpers/install.ts"],"sourcesContent":[null],"mappings":";;;;;+BAyBgB;;;WAAAA,OAAA;;;6DAzBE;kEACA;;;;;;AAwBX,SAASA,QACdC,IAAY,EACZC,YAA6B,EAC7B;EAAEC,cAAc;EAAEC,QAAQ;EAAEC;AAAe,CAAe;EAE1D;;;EAGA,MAAMC,QAAA,GAAqB,EAAE;EAC7B;;;EAGA,MAAMC,SAAA,GAAsB,EAAE;EAC9B;;;EAGA,OAAO,IAAIC,OAAA,CAAQ,CAACC,OAAA,EAASC,MAAA;IAC3B,IAAIC,IAAA;IACJ,IAAIC,OAAA,GAAUT,cAAA;IACd,MAAMU,OAAA,GAAUV,cAAA,KAAmB;IAEnC,IAAID,YAAA,IAAgBA,YAAA,CAAaY,MAAM,EAAE;MACvC;;;MAGA,IAAID,OAAA,EAAS;QACX;;;QAGAF,IAAA,GAAO,CAAC,OAAO,UAAU;QACzB,IAAI,CAACP,QAAA,EAAUO,IAAA,CAAKI,IAAI,CAAC;QACzBJ,IAAA,CAAKI,IAAI,CAAC,SAASd,IAAA;QACnB,IAAII,eAAA,EAAiBM,IAAA,CAAKI,IAAI,CAAC;QAC/BJ,IAAA,CAAKI,IAAI,IAAIb,YAAA;MACf,OAAO;QACL;;;QAGAS,IAAA,GAAO,CAAC,WAAW,eAAe;QAClCA,IAAA,CAAKI,IAAI,CAACV,eAAA,GAAkB,eAAe;QAC3CM,IAAA,CAAKI,IAAI,IAAIb,YAAA;MACf;IACF,OAAO;MACL;;;;MAIAS,IAAA,GAAO,CAAC,UAAU;MAClB,IAAI,CAACP,QAAA,EAAU;QACbY,OAAA,CAAQC,GAAG,CAACC,MAAA,CAAAC,OAAK,CAACC,MAAM,CAAC;QACzB,IAAIP,OAAA,EAAS;UACXG,OAAA,CAAQC,GAAG,CAACC,MAAA,CAAAC,OAAK,CAACC,MAAM,CAAC;UACzBJ,OAAA,CAAQC,GAAG;UACXN,IAAA,CAAKI,IAAI,CAAC;QACZ,OAAO;UACLC,OAAA,CAAQC,GAAG;QACb;MACF;IACF;IACA;;;IAGA,IAAIJ,OAAA,EAAS;MACXF,IAAA,CAAKI,IAAI,IAAIR,SAAA;IACf,OAAO;MACLI,IAAA,CAAKI,IAAI,IAAIT,QAAA;IACf;IACA;;;IAGA,MAAMe,KAAA,GAAQ,IAAAC,WAAA,CAAAH,OAAK,EAACP,OAAA,EAASD,IAAA,EAAM;MACjCY,KAAA,EAAO;MACPC,GAAA,EAAK;QACH,GAAGC,OAAA,CAAQD,GAAG;QACdE,OAAA,EAAS;QACT;QACA;QACAC,QAAA,EAAU;QACVC,sBAAA,EAAwB;MAC1B;IACF;IACAP,KAAA,CAAMQ,EAAE,CAAC,SAAUC,IAAA;MACjB,IAAIA,IAAA,KAAS,GAAG;QACdpB,MAAA,CAAO;UAAEE,OAAA,EAAU,GAAEA,OAAQ,IAAGD,IAAA,CAAKoB,IAAI,CAAC,IAAK;QAAE;QACjD;MACF;MACAtB,OAAA;IACF;EACF;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}