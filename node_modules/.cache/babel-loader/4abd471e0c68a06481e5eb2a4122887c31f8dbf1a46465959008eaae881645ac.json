{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"getRscError\", {\n  enumerable: true,\n  get: function () {\n    return getRscError;\n  }\n});\nconst _getModuleTrace = require(\"./getModuleTrace\");\nconst _simpleWebpackError = require(\"./simpleWebpackError\");\nfunction formatRSCErrorMessage(message, isPagesDir, fileName) {\n  let formattedMessage = message;\n  let formattedVerboseMessage = \"\";\n  // Comes from the \"React Server Components\" transform in SWC, always\n  // attach the module trace.\n  const NEXT_RSC_ERR_REACT_API = /.+NEXT_RSC_ERR_REACT_API: (.*?)\\n/s;\n  const NEXT_RSC_ERR_SERVER_IMPORT = /.+NEXT_RSC_ERR_SERVER_IMPORT: (.*?)\\n/s;\n  const NEXT_RSC_ERR_CLIENT_IMPORT = /.+NEXT_RSC_ERR_CLIENT_IMPORT: (.*?)\\n/s;\n  const NEXT_RSC_ERR_CLIENT_METADATA_EXPORT = /.+NEXT_RSC_ERR_CLIENT_METADATA_EXPORT: (.*?)\\n/s;\n  const NEXT_RSC_ERR_CONFLICT_METADATA_EXPORT = /NEXT_RSC_ERR_CONFLICT_METADATA_EXPORT/s;\n  const NEXT_RSC_ERR_CLIENT_DIRECTIVE = /.+NEXT_RSC_ERR_CLIENT_DIRECTIVE\\n/s;\n  const NEXT_RSC_ERR_CLIENT_DIRECTIVE_PAREN = /.+NEXT_RSC_ERR_CLIENT_DIRECTIVE_PAREN\\n/s;\n  const NEXT_RSC_ERR_INVALID_API = /.+NEXT_RSC_ERR_INVALID_API: (.*?)\\n/s;\n  const NEXT_RSC_ERR_ERROR_FILE_SERVER_COMPONENT = /.+NEXT_RSC_ERR_ERROR_FILE_SERVER_COMPONENT/;\n  if (NEXT_RSC_ERR_REACT_API.test(message)) {\n    const matches = message.match(NEXT_RSC_ERR_REACT_API);\n    if (matches && matches[1] === \"Component\") {\n      formattedMessage = `\\n\\nYouâ€™re importing a class component. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials#client-components\\n\\n`;\n    } else {\n      formattedMessage = message.replace(NEXT_RSC_ERR_REACT_API, `\\n\\nYou're importing a component that needs $1. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials\\n\\n`);\n    }\n    formattedVerboseMessage = '\\n\\nMaybe one of these should be marked as a client entry with \"use client\":\\n';\n  } else if (NEXT_RSC_ERR_SERVER_IMPORT.test(message)) {\n    let shouldAddUseClient = true;\n    const matches = message.match(NEXT_RSC_ERR_SERVER_IMPORT);\n    switch (matches && matches[1]) {\n      case \"react-dom/server\":\n        // If importing \"react-dom/server\", we should show a different error.\n        formattedMessage = `\\n\\nYou're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials`;\n        break;\n      case \"next/router\":\n        // If importing \"next/router\", we should tell them to use \"next/navigation\".\n        formattedMessage = `\\n\\nYou have a Server Component that imports next/router. Use next/navigation instead.\\nLearn more: https://nextjs.org/docs/app/api-reference/functions/use-router`;\n        shouldAddUseClient = false;\n        break;\n      default:\n        formattedMessage = message.replace(NEXT_RSC_ERR_SERVER_IMPORT, `\\n\\nYou're importing a component that imports $1. It only works in a Client Component but none of its parents are marked with \"use client\", so they're Server Components by default.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials\\n\\n`);\n    }\n    formattedVerboseMessage = shouldAddUseClient ? '\\n\\nMaybe one of these should be marked as a client entry \"use client\":\\n' : \"\\n\\nImport trace:\\n\";\n  } else if (NEXT_RSC_ERR_CLIENT_IMPORT.test(message)) {\n    if (isPagesDir) {\n      formattedMessage = message.replace(NEXT_RSC_ERR_CLIENT_IMPORT, `\\n\\nYou're importing a component that needs $1. That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/getting-started/react-essentials#server-components\\n\\n`);\n      formattedVerboseMessage = \"\\n\\nImport trace for requested module:\\n\";\n    } else {\n      formattedMessage = message.replace(NEXT_RSC_ERR_CLIENT_IMPORT, `\\n\\nYou're importing a component that needs $1. That only works in a Server Component but one of its parents is marked with \"use client\", so it's a Client Component.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials\\n\\n`);\n      formattedVerboseMessage = '\\n\\nOne of these is marked as a client entry with \"use client\":\\n';\n    }\n  } else if (NEXT_RSC_ERR_CLIENT_DIRECTIVE.test(message)) {\n    formattedMessage = message.replace(NEXT_RSC_ERR_CLIENT_DIRECTIVE, `\\n\\nThe \"use client\" directive must be placed before other expressions. Move it to the top of the file to resolve this issue.\\n\\n`);\n    formattedVerboseMessage = \"\\n\\nImport path:\\n\";\n  } else if (NEXT_RSC_ERR_CLIENT_DIRECTIVE_PAREN.test(message)) {\n    formattedMessage = message.replace(NEXT_RSC_ERR_CLIENT_DIRECTIVE_PAREN, `\\n\\n\"use client\" must be a directive, and placed before other expressions. Remove the parentheses and move it to the top of the file to resolve this issue.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials#the-use-client-directive\\n\\n`);\n    formattedVerboseMessage = \"\\n\\nImport path:\\n\";\n  } else if (NEXT_RSC_ERR_INVALID_API.test(message)) {\n    formattedMessage = message.replace(NEXT_RSC_ERR_INVALID_API, `\\n\\n\"$1\" is not supported in app/. Read more: https://nextjs.org/docs/app/building-your-application/data-fetching\\n\\n`);\n    formattedVerboseMessage = \"\\n\\nFile path:\\n\";\n  } else if (NEXT_RSC_ERR_ERROR_FILE_SERVER_COMPONENT.test(message)) {\n    formattedMessage = message.replace(NEXT_RSC_ERR_ERROR_FILE_SERVER_COMPONENT, `\\n\\n${fileName} must be a Client Component. Add the \"use client\" directive the top of the file to resolve this issue.\\nLearn more: https://nextjs.org/docs/getting-started/react-essentials#client-components\\n\\n`);\n    formattedVerboseMessage = \"\\n\\nImport path:\\n\";\n  } else if (NEXT_RSC_ERR_CLIENT_METADATA_EXPORT.test(message)) {\n    formattedMessage = message.replace(NEXT_RSC_ERR_CLIENT_METADATA_EXPORT, `\\n\\nYou are attempting to export \"$1\" from a component marked with \"use client\", which is disallowed. Either remove the export, or the \"use client\" directive. Read more: https://nextjs.org/docs/getting-started/react-essentials#the-use-client-directive\\n\\n`);\n    formattedVerboseMessage = \"\\n\\nFile path:\\n\";\n  } else if (NEXT_RSC_ERR_CONFLICT_METADATA_EXPORT.test(message)) {\n    formattedMessage = message.replace(NEXT_RSC_ERR_CONFLICT_METADATA_EXPORT, `\\n\\n\"metadata\" and \"generateMetadata\" cannot be exported at the same time, please keep one of them. Read more: https://nextjs.org/docs/app/api-reference/file-conventions/metadata\\n\\n`);\n    formattedVerboseMessage = \"\\n\\nFile path:\\n\";\n  }\n  return [formattedMessage, formattedVerboseMessage];\n}\nfunction getRscError(fileName, err, module, compilation, compiler) {\n  if (!err.message || !/NEXT_RSC_ERR_/.test(err.message)) {\n    return false;\n  }\n  const {\n    isPagesDir,\n    moduleTrace\n  } = (0, _getModuleTrace.getModuleTrace)(module, compilation, compiler);\n  const formattedError = formatRSCErrorMessage(err.message, isPagesDir, fileName);\n  const {\n    formattedModuleTrace,\n    lastInternalFileName,\n    invalidImportMessage\n  } = (0, _getModuleTrace.formatModuleTrace)(compiler, moduleTrace);\n  const error = new _simpleWebpackError.SimpleWebpackError(lastInternalFileName, \"ReactServerComponentsError:\\n\" + formattedError[0] + invalidImportMessage + formattedError[1] + formattedModuleTrace);\n  // Delete the stack because it's created here.\n  error.stack = \"\";\n  return error;\n}","map":{"version":3,"names":["getRscError","formatRSCErrorMessage","message","isPagesDir","fileName","formattedMessage","formattedVerboseMessage","NEXT_RSC_ERR_REACT_API","NEXT_RSC_ERR_SERVER_IMPORT","NEXT_RSC_ERR_CLIENT_IMPORT","NEXT_RSC_ERR_CLIENT_METADATA_EXPORT","NEXT_RSC_ERR_CONFLICT_METADATA_EXPORT","NEXT_RSC_ERR_CLIENT_DIRECTIVE","NEXT_RSC_ERR_CLIENT_DIRECTIVE_PAREN","NEXT_RSC_ERR_INVALID_API","NEXT_RSC_ERR_ERROR_FILE_SERVER_COMPONENT","test","matches","match","replace","shouldAddUseClient","err","module","compilation","compiler","moduleTrace","_getModuleTrace","getModuleTrace","formattedError","formattedModuleTrace","lastInternalFileName","invalidImportMessage","formatModuleTrace","error","_simpleWebpackError","SimpleWebpackError","stack"],"sources":["../../../../../src/build/webpack/plugins/wellknown-errors-plugin/parseRSC.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}