{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  clearModuleContext: null,\n  getModuleContext: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  clearModuleContext: function () {\n    return clearModuleContext;\n  },\n  getModuleContext: function () {\n    return getModuleContext;\n  }\n});\nconst _async_hooks = require(\"async_hooks\");\nconst _middleware = require(\"next/dist/compiled/@next/react-dev-overlay/dist/middleware\");\nconst _constants = require(\"../../../shared/lib/constants\");\nconst _edgeruntime = require(\"next/dist/compiled/edge-runtime\");\nconst _fs = require(\"fs\");\nconst _utils = require(\"../utils\");\nconst _pick = require(\"../../../lib/pick\");\nconst _fetchinlineassets = require(\"./fetch-inline-assets\");\nconst _vm = require(\"vm\");\nconst _nodebuffer = /*#__PURE__*/_interop_require_default(require(\"node:buffer\"));\nconst _nodeevents = /*#__PURE__*/_interop_require_default(require(\"node:events\"));\nconst _nodeassert = /*#__PURE__*/_interop_require_default(require(\"node:assert\"));\nconst _nodeutil = /*#__PURE__*/_interop_require_default(require(\"node:util\"));\nconst _nodeasync_hooks = /*#__PURE__*/_interop_require_default(require(\"node:async_hooks\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n/**\n * A Map of cached module contexts indexed by the module name. It allows\n * to have a different cache scoped per module name or depending on the\n * provided module key on creation.\n */\nconst moduleContexts = new Map();\nconst pendingModuleCaches = new Map();\nasync function clearModuleContext(path) {\n  const handleContext = (key, cache, context) => {\n    if (cache == null ? void 0 : cache.paths.has(path)) {\n      context.delete(key);\n    }\n  };\n  for (const [key, cache] of moduleContexts) {\n    handleContext(key, cache, moduleContexts);\n  }\n  for (const [key, cache] of pendingModuleCaches) {\n    handleContext(key, await cache, pendingModuleCaches);\n  }\n}\nasync function loadWasm(wasm) {\n  const modules = {};\n  await Promise.all(wasm.map(async binding => {\n    const module1 = await WebAssembly.compile(await _fs.promises.readFile(binding.filePath));\n    modules[binding.name] = module1;\n  }));\n  return modules;\n}\nfunction buildEnvironmentVariablesFrom() {\n  const pairs = Object.keys(process.env).map(key => [key, process.env[key]]);\n  const env = Object.fromEntries(pairs);\n  env.NEXT_RUNTIME = \"edge\";\n  return env;\n}\nfunction throwUnsupportedAPIError(name) {\n  const error = new Error(`A Node.js API is used (${name}) which is not supported in the Edge Runtime.\nLearn more: https://nextjs.org/docs/api-reference/edge-runtime`);\n  (0, _middleware.decorateServerError)(error, _constants.COMPILER_NAMES.edgeServer);\n  throw error;\n}\nfunction createProcessPolyfill() {\n  const processPolyfill = {\n    env: buildEnvironmentVariablesFrom()\n  };\n  const overridenValue = {};\n  for (const key of Object.keys(process)) {\n    if (key === \"env\") continue;\n    Object.defineProperty(processPolyfill, key, {\n      get() {\n        if (overridenValue[key] !== undefined) {\n          return overridenValue[key];\n        }\n        if (typeof process[key] === \"function\") {\n          return () => throwUnsupportedAPIError(`process.${key}`);\n        }\n        return undefined;\n      },\n      set(value) {\n        overridenValue[key] = value;\n      },\n      enumerable: false\n    });\n  }\n  return processPolyfill;\n}\nfunction addStub(context, name) {\n  Object.defineProperty(context, name, {\n    get() {\n      return function () {\n        throwUnsupportedAPIError(name);\n      };\n    },\n    enumerable: false\n  });\n}\nfunction getDecorateUnhandledError(runtime) {\n  const EdgeRuntimeError = runtime.evaluate(`Error`);\n  return error => {\n    if (error instanceof EdgeRuntimeError) {\n      (0, _middleware.decorateServerError)(error, _constants.COMPILER_NAMES.edgeServer);\n    }\n  };\n}\nfunction getDecorateUnhandledRejection(runtime) {\n  const EdgeRuntimeError = runtime.evaluate(`Error`);\n  return rejected => {\n    if (rejected.reason instanceof EdgeRuntimeError) {\n      (0, _middleware.decorateServerError)(rejected.reason, _constants.COMPILER_NAMES.edgeServer);\n    }\n  };\n}\nconst NativeModuleMap = (() => {\n  const mods = {\n    \"node:buffer\": (0, _pick.pick)(_nodebuffer.default, [\"constants\", \"kMaxLength\", \"kStringMaxLength\", \"Buffer\", \"SlowBuffer\"]),\n    \"node:events\": (0, _pick.pick)(_nodeevents.default, [\"EventEmitter\", \"captureRejectionSymbol\", \"defaultMaxListeners\", \"errorMonitor\", \"listenerCount\", \"on\", \"once\"]),\n    \"node:async_hooks\": (0, _pick.pick)(_nodeasync_hooks.default, [\"AsyncLocalStorage\", \"AsyncResource\"]),\n    \"node:assert\": (0, _pick.pick)(_nodeassert.default, [\"AssertionError\", \"deepEqual\", \"deepStrictEqual\", \"doesNotMatch\", \"doesNotReject\", \"doesNotThrow\", \"equal\", \"fail\", \"ifError\", \"match\", \"notDeepEqual\", \"notDeepStrictEqual\", \"notEqual\", \"notStrictEqual\", \"ok\", \"rejects\", \"strict\", \"strictEqual\", \"throws\"]),\n    \"node:util\": (0, _pick.pick)(_nodeutil.default, [\"_extend\", \"callbackify\", \"format\", \"inherits\", \"promisify\", \"types\"])\n  };\n  return new Map(Object.entries(mods));\n})();\n/**\n * Create a module cache specific for the provided parameters. It includes\n * a runtime context, require cache and paths cache.\n */\nasync function createModuleContext(options) {\n  const warnedEvals = new Set();\n  const warnedWasmCodegens = new Set();\n  const wasm = await loadWasm(options.edgeFunctionEntry.wasm ?? []);\n  const runtime = new _edgeruntime.EdgeRuntime({\n    codeGeneration: process.env.NODE_ENV !== \"production\" ? {\n      strings: true,\n      wasm: true\n    } : undefined,\n    extend: context => {\n      context.process = createProcessPolyfill();\n      Object.defineProperty(context, \"require\", {\n        enumerable: false,\n        value: id => {\n          const value = NativeModuleMap.get(id);\n          if (!value) {\n            throw TypeError(\"Native module not found: \" + id);\n          }\n          return value;\n        }\n      });\n      context.__next_eval__ = function __next_eval__(fn) {\n        const key = fn.toString();\n        if (!warnedEvals.has(key)) {\n          const warning = (0, _middleware.getServerError)(new Error(`Dynamic Code Evaluation (e. g. 'eval', 'new Function') not allowed in Edge Runtime\nLearn More: https://nextjs.org/docs/messages/edge-dynamic-code-evaluation`), _constants.COMPILER_NAMES.edgeServer);\n          warning.name = \"DynamicCodeEvaluationWarning\";\n          Error.captureStackTrace(warning, __next_eval__);\n          warnedEvals.add(key);\n          options.onWarning(warning);\n        }\n        return fn();\n      };\n      context.__next_webassembly_compile__ = function __next_webassembly_compile__(fn) {\n        const key = fn.toString();\n        if (!warnedWasmCodegens.has(key)) {\n          const warning = (0, _middleware.getServerError)(new Error(`Dynamic WASM code generation (e. g. 'WebAssembly.compile') not allowed in Edge Runtime.\nLearn More: https://nextjs.org/docs/messages/edge-dynamic-code-evaluation`), _constants.COMPILER_NAMES.edgeServer);\n          warning.name = \"DynamicWasmCodeGenerationWarning\";\n          Error.captureStackTrace(warning, __next_webassembly_compile__);\n          warnedWasmCodegens.add(key);\n          options.onWarning(warning);\n        }\n        return fn();\n      };\n      context.__next_webassembly_instantiate__ = async function __next_webassembly_instantiate__(fn) {\n        const result = await fn();\n        // If a buffer is given, WebAssembly.instantiate returns an object\n        // containing both a module and an instance while it returns only an\n        // instance if a WASM module is given. Utilize the fact to determine\n        // if the WASM code generation happens.\n        //\n        // https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiate#primary_overload_%E2%80%94_taking_wasm_binary_code\n        const instantiatedFromBuffer = result.hasOwnProperty(\"module\");\n        const key = fn.toString();\n        if (instantiatedFromBuffer && !warnedWasmCodegens.has(key)) {\n          const warning = (0, _middleware.getServerError)(new Error(`Dynamic WASM code generation ('WebAssembly.instantiate' with a buffer parameter) not allowed in Edge Runtime.\nLearn More: https://nextjs.org/docs/messages/edge-dynamic-code-evaluation`), _constants.COMPILER_NAMES.edgeServer);\n          warning.name = \"DynamicWasmCodeGenerationWarning\";\n          Error.captureStackTrace(warning, __next_webassembly_instantiate__);\n          warnedWasmCodegens.add(key);\n          options.onWarning(warning);\n        }\n        return result;\n      };\n      const __fetch = context.fetch;\n      context.fetch = async (input, init = {}) => {\n        var _init_headers_get;\n        const callingError = new Error(\"[internal]\");\n        const assetResponse = await (0, _fetchinlineassets.fetchInlineAsset)({\n          input,\n          assets: options.edgeFunctionEntry.assets,\n          distDir: options.distDir,\n          context\n        });\n        if (assetResponse) {\n          return assetResponse;\n        }\n        init.headers = new Headers(init.headers ?? {});\n        const prevs = ((_init_headers_get = init.headers.get(`x-middleware-subrequest`)) == null ? void 0 : _init_headers_get.split(\":\")) || [];\n        const value = prevs.concat(options.moduleName).join(\":\");\n        init.headers.set(\"x-middleware-subrequest\", value);\n        if (!init.headers.has(\"user-agent\")) {\n          init.headers.set(`user-agent`, `Next.js Middleware`);\n        }\n        const response = typeof input === \"object\" && \"url\" in input ? __fetch(input.url, {\n          ...(0, _pick.pick)(input, [\"method\", \"body\", \"cache\", \"credentials\", \"integrity\", \"keepalive\", \"mode\", \"redirect\", \"referrer\", \"referrerPolicy\", \"signal\"]),\n          ...init,\n          headers: {\n            ...Object.fromEntries(input.headers),\n            ...Object.fromEntries(init.headers)\n          }\n        }) : __fetch(String(input), init);\n        return await response.catch(err => {\n          callingError.message = err.message;\n          err.stack = callingError.stack;\n          throw err;\n        });\n      };\n      const __Request = context.Request;\n      context.Request = class extends __Request {\n        constructor(input, init) {\n          const url = typeof input !== \"string\" && \"url\" in input ? input.url : String(input);\n          (0, _utils.validateURL)(url);\n          super(url, init);\n          this.next = init == null ? void 0 : init.next;\n        }\n      };\n      const __redirect = context.Response.redirect.bind(context.Response);\n      context.Response.redirect = (...args) => {\n        (0, _utils.validateURL)(args[0]);\n        return __redirect(...args);\n      };\n      for (const name of _constants.EDGE_UNSUPPORTED_NODE_APIS) {\n        addStub(context, name);\n      }\n      Object.assign(context, wasm);\n      context.AsyncLocalStorage = _async_hooks.AsyncLocalStorage;\n      return context;\n    }\n  });\n  const decorateUnhandledError = getDecorateUnhandledError(runtime);\n  runtime.context.addEventListener(\"error\", decorateUnhandledError);\n  const decorateUnhandledRejection = getDecorateUnhandledRejection(runtime);\n  runtime.context.addEventListener(\"unhandledrejection\", decorateUnhandledRejection);\n  return {\n    runtime,\n    paths: new Map(),\n    warnedEvals: new Set()\n  };\n}\nfunction getModuleContextShared(options) {\n  let deferredModuleContext = pendingModuleCaches.get(options.moduleName);\n  if (!deferredModuleContext) {\n    deferredModuleContext = createModuleContext(options);\n    pendingModuleCaches.set(options.moduleName, deferredModuleContext);\n  }\n  return deferredModuleContext;\n}\nasync function getModuleContext(options) {\n  let lazyModuleContext;\n  if (options.useCache) {\n    lazyModuleContext = moduleContexts.get(options.moduleName) || (await getModuleContextShared(options));\n  }\n  if (!lazyModuleContext) {\n    lazyModuleContext = await createModuleContext(options);\n    moduleContexts.set(options.moduleName, lazyModuleContext);\n  }\n  const moduleContext = lazyModuleContext;\n  const evaluateInContext = filepath => {\n    if (!moduleContext.paths.has(filepath)) {\n      const content = (0, _fs.readFileSync)(filepath, \"utf-8\");\n      try {\n        (0, _vm.runInContext)(content, moduleContext.runtime.context, {\n          filename: filepath\n        });\n        moduleContext.paths.set(filepath, content);\n      } catch (error) {\n        if (options.useCache) {\n          moduleContext == null ? void 0 : moduleContext.paths.delete(filepath);\n        }\n        throw error;\n      }\n    }\n  };\n  return {\n    ...moduleContext,\n    evaluateInContext\n  };\n}","map":{"version":3,"names":["clearModuleContext","getModuleContext","moduleContexts","Map","pendingModuleCaches","path","handleContext","key","cache","context","paths","has","delete","loadWasm","wasm","modules","Promise","all","map","binding","module1","WebAssembly","compile","_fs","promises","readFile","filePath","name","buildEnvironmentVariablesFrom","pairs","Object","keys","process","env","fromEntries","NEXT_RUNTIME","throwUnsupportedAPIError","error","Error","_middleware","decorateServerError","_constants","COMPILER_NAMES","edgeServer","createProcessPolyfill","processPolyfill","overridenValue","defineProperty","get","undefined","set","value","enumerable","addStub","getDecorateUnhandledError","runtime","EdgeRuntimeError","evaluate","getDecorateUnhandledRejection","rejected","reason","NativeModuleMap","mods","_pick","pick","_nodebuffer","default","_nodeevents","_nodeasync_hooks","_nodeassert","_nodeutil","entries","createModuleContext","options","warnedEvals","Set","warnedWasmCodegens","edgeFunctionEntry","_edgeruntime","EdgeRuntime","codeGeneration","NODE_ENV","strings","extend","id","TypeError","__next_eval__","fn","toString","warning","getServerError","captureStackTrace","add","onWarning","__next_webassembly_compile__","__next_webassembly_instantiate__","result","instantiatedFromBuffer","hasOwnProperty","__fetch","fetch","input","init","_init_headers_get","callingError","assetResponse","_fetchinlineassets","fetchInlineAsset","assets","distDir","headers","Headers","prevs","split","concat","moduleName","join","response","url","String","catch","err","message","stack","__Request","Request","constructor","_utils","validateURL","next","__redirect","Response","redirect","bind","args","EDGE_UNSUPPORTED_NODE_APIS","assign","AsyncLocalStorage","_async_hooks","decorateUnhandledError","addEventListener","decorateUnhandledRejection","getModuleContextShared","deferredModuleContext","lazyModuleContext","useCache","moduleContext","evaluateInContext","filepath","content","readFileSync","_vm","runInContext","filename"],"sources":["../../../../src/server/web/sandbox/context.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}