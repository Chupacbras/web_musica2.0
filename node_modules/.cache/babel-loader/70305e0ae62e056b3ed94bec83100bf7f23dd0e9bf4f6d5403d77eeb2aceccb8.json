{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"createIncrementalCache\", {\n  enumerable: true,\n  get: function () {\n    return createIncrementalCache;\n  }\n});\nconst _path = /*#__PURE__*/_interop_require_default(require(\"path\"));\nconst _fs = /*#__PURE__*/_interop_require_default(require(\"fs\"));\nconst _incrementalcache = require(\"../../server/lib/incremental-cache\");\nconst _ciinfo = require(\"../../telemetry/ci-info\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction createIncrementalCache(incrementalCacheHandlerPath, isrMemoryCacheSize, fetchCacheKeyPrefix, distDir) {\n  // Custom cache handler overrides.\n  let CacheHandler;\n  if (incrementalCacheHandlerPath) {\n    CacheHandler = require(incrementalCacheHandlerPath);\n    CacheHandler = CacheHandler.default || CacheHandler;\n  }\n  const incrementalCache = new _incrementalcache.IncrementalCache({\n    dev: false,\n    requestHeaders: {},\n    flushToDisk: true,\n    fetchCache: true,\n    maxMemoryCacheSize: isrMemoryCacheSize,\n    fetchCacheKeyPrefix,\n    getPrerenderManifest: () => ({\n      version: 4,\n      routes: {},\n      dynamicRoutes: {},\n      preview: {\n        previewModeEncryptionKey: \"\",\n        previewModeId: \"\",\n        previewModeSigningKey: \"\"\n      },\n      notFoundRoutes: []\n    }),\n    fs: {\n      readFile: f => _fs.default.promises.readFile(f),\n      readFileSync: f => _fs.default.readFileSync(f),\n      writeFile: (f, d) => _fs.default.promises.writeFile(f, d),\n      mkdir: dir => _fs.default.promises.mkdir(dir, {\n        recursive: true\n      }),\n      stat: f => _fs.default.promises.stat(f)\n    },\n    serverDistDir: _path.default.join(distDir, \"server\"),\n    CurCacheHandler: CacheHandler,\n    minimalMode: _ciinfo.hasNextSupport\n  });\n  globalThis.__incrementalCache = incrementalCache;\n  return incrementalCache;\n}","map":{"version":3,"names":["createIncrementalCache","incrementalCacheHandlerPath","isrMemoryCacheSize","fetchCacheKeyPrefix","distDir","CacheHandler","require","default","incrementalCache","_incrementalcache","IncrementalCache","dev","requestHeaders","flushToDisk","fetchCache","maxMemoryCacheSize","getPrerenderManifest","version","routes","dynamicRoutes","preview","previewModeEncryptionKey","previewModeId","previewModeSigningKey","notFoundRoutes","fs","readFile","f","_fs","promises","readFileSync","writeFile","d","mkdir","dir","recursive","stat","serverDistDir","_path","join","CurCacheHandler","minimalMode","_ciinfo","hasNextSupport","globalThis","__incrementalCache"],"sources":["../../../src/export/helpers/create-incremental-cache.ts"],"sourcesContent":[null],"mappings":";;;;;+BAKgB;;;WAAAA,sBAAA;;;4DALC;0DACF;kCACkB;wBACF;;;;;;AAExB,SAASA,uBACdC,2BAA+C,EAC/CC,kBAAsC,EACtCC,mBAAuC,EACvCC,OAAe;EAEf;EACA,IAAIC,YAAA;EACJ,IAAIJ,2BAAA,EAA6B;IAC/BI,YAAA,GAAeC,OAAA,CAAQL,2BAAA;IACvBI,YAAA,GAAeA,YAAA,CAAaE,OAAO,IAAIF,YAAA;EACzC;EAEA,MAAMG,gBAAA,GAAmB,IAAIC,iBAAA,CAAAC,gBAAgB,CAAC;IAC5CC,GAAA,EAAK;IACLC,cAAA,EAAgB,CAAC;IACjBC,WAAA,EAAa;IACbC,UAAA,EAAY;IACZC,kBAAA,EAAoBb,kBAAA;IACpBC,mBAAA;IACAa,oBAAA,EAAsBA,CAAA,MAAO;MAC3BC,OAAA,EAAS;MACTC,MAAA,EAAQ,CAAC;MACTC,aAAA,EAAe,CAAC;MAChBC,OAAA,EAAS;QACPC,wBAAA,EAA0B;QAC1BC,aAAA,EAAe;QACfC,qBAAA,EAAuB;MACzB;MACAC,cAAA,EAAgB;IAClB;IACAC,EAAA,EAAI;MACFC,QAAA,EAAWC,CAAA,IAAMC,GAAA,CAAArB,OAAE,CAACsB,QAAQ,CAACH,QAAQ,CAACC,CAAA;MACtCG,YAAA,EAAeH,CAAA,IAAMC,GAAA,CAAArB,OAAE,CAACuB,YAAY,CAACH,CAAA;MACrCI,SAAA,EAAWA,CAACJ,CAAA,EAAGK,CAAA,KAAMJ,GAAA,CAAArB,OAAE,CAACsB,QAAQ,CAACE,SAAS,CAACJ,CAAA,EAAGK,CAAA;MAC9CC,KAAA,EAAQC,GAAA,IAAQN,GAAA,CAAArB,OAAE,CAACsB,QAAQ,CAACI,KAAK,CAACC,GAAA,EAAK;QAAEC,SAAA,EAAW;MAAK;MACzDC,IAAA,EAAOT,CAAA,IAAMC,GAAA,CAAArB,OAAE,CAACsB,QAAQ,CAACO,IAAI,CAACT,CAAA;IAChC;IACAU,aAAA,EAAeC,KAAA,CAAA/B,OAAI,CAACgC,IAAI,CAACnC,OAAA,EAAS;IAClCoC,eAAA,EAAiBnC,YAAA;IACjBoC,WAAA,EAAaC,OAAA,CAAAC;EACf;EAEEC,UAAA,CAAmBC,kBAAkB,GAAGrC,gBAAA;EAE1C,OAAOA,gBAAA;AACT"},"metadata":{},"sourceType":"script","externalDependencies":[]}