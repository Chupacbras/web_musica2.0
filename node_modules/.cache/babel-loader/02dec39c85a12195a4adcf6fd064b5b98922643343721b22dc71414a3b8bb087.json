{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  setRevalidateHeaders: null,\n  sendEtagResponse: null,\n  sendRenderResult: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  setRevalidateHeaders: function () {\n    return _revalidateheaders.setRevalidateHeaders;\n  },\n  sendEtagResponse: function () {\n    return sendEtagResponse;\n  },\n  sendRenderResult: function () {\n    return sendRenderResult;\n  }\n});\nconst _utils = require(\"../../shared/lib/utils\");\nconst _etag = require(\"../lib/etag\");\nconst _fresh = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/fresh\"));\nconst _revalidateheaders = require(\"./revalidate-headers\");\nconst _approuterheaders = require(\"../../client/components/app-router-headers\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nfunction sendEtagResponse(req, res, etag) {\n  if (etag) {\n    /**\n    * The server generating a 304 response MUST generate any of the\n    * following header fields that would have been sent in a 200 (OK)\n    * response to the same request: Cache-Control, Content-Location, Date,\n    * ETag, Expires, and Vary. https://tools.ietf.org/html/rfc7232#section-4.1\n    */\n    res.setHeader(\"ETag\", etag);\n  }\n  if ((0, _fresh.default)(req.headers, {\n    etag\n  })) {\n    res.statusCode = 304;\n    res.end();\n    return true;\n  }\n  return false;\n}\nasync function sendRenderResult({\n  req,\n  res,\n  result,\n  type,\n  generateEtags,\n  poweredByHeader,\n  options\n}) {\n  if ((0, _utils.isResSent)(res)) {\n    return;\n  }\n  if (poweredByHeader && type === \"html\") {\n    res.setHeader(\"X-Powered-By\", \"Next.js\");\n  }\n  if (options != null) {\n    (0, _revalidateheaders.setRevalidateHeaders)(res, options);\n  }\n  const payload = result.isDynamic ? null : await result.toUnchunkedString();\n  if (payload !== null) {\n    const etag = generateEtags ? (0, _etag.generateETag)(payload) : undefined;\n    if (sendEtagResponse(req, res, etag)) {\n      return;\n    }\n  }\n  if (!res.getHeader(\"Content-Type\")) {\n    res.setHeader(\"Content-Type\", result.contentType ? result.contentType : type === \"rsc\" ? _approuterheaders.RSC_CONTENT_TYPE_HEADER : type === \"json\" ? \"application/json\" : \"text/html; charset=utf-8\");\n  }\n  if (payload) {\n    res.setHeader(\"Content-Length\", Buffer.byteLength(payload));\n  }\n  if (req.method === \"HEAD\") {\n    res.end(null);\n  } else if (payload !== null) {\n    res.end(payload);\n  } else {\n    await result.pipe(res);\n  }\n}","map":{"version":3,"names":["setRevalidateHeaders","_revalidateheaders","sendEtagResponse","sendRenderResult","req","res","etag","setHeader","_fresh","default","headers","statusCode","end","result","type","generateEtags","poweredByHeader","options","_utils","isResSent","payload","isDynamic","toUnchunkedString","_etag","generateETag","undefined","getHeader","contentType","_approuterheaders","RSC_CONTENT_TYPE_HEADER","Buffer","byteLength","method","pipe"],"sources":["../../../src/server/send-payload/index.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;;EAcSA,oBAAoB,WAAAA,CAAA;WAApBC,kBAAA,CAAAD,oBAAoB;;EAEbE,gBAAgB,WAAAA,CAAA;WAAhBA,gBAAA;;EAwBMC,gBAAgB,WAAAA,CAAA;WAAhBA,gBAAA;;;uBAtCI;sBACG;6DACX;mCAEmB;kCACG;;;;;;AASjC,SAASD,iBACdE,GAAoB,EACpBC,GAAmB,EACnBC,IAAwB;EAExB,IAAIA,IAAA,EAAM;IACR;;;;;;IAMAD,GAAA,CAAIE,SAAS,CAAC,QAAQD,IAAA;EACxB;EAEA,IAAI,IAAAE,MAAA,CAAAC,OAAK,EAACL,GAAA,CAAIM,OAAO,EAAE;IAAEJ;EAAK,IAAI;IAChCD,GAAA,CAAIM,UAAU,GAAG;IACjBN,GAAA,CAAIO,GAAG;IACP,OAAO;EACT;EAEA,OAAO;AACT;AAEO,eAAeT,iBAAiB;EACrCC,GAAG;EACHC,GAAG;EACHQ,MAAM;EACNC,IAAI;EACJC,aAAa;EACbC,eAAe;EACfC;AAAO,CASR;EACC,IAAI,IAAAC,MAAA,CAAAC,SAAS,EAACd,GAAA,GAAM;IAClB;EACF;EAEA,IAAIW,eAAA,IAAmBF,IAAA,KAAS,QAAQ;IACtCT,GAAA,CAAIE,SAAS,CAAC,gBAAgB;EAChC;EAEA,IAAIU,OAAA,IAAW,MAAM;IACnB,IAAAhB,kBAAA,CAAAD,oBAAoB,EAACK,GAAA,EAAKY,OAAA;EAC5B;EAEA,MAAMG,OAAA,GAAUP,MAAA,CAAOQ,SAAS,GAAG,OAAO,MAAMR,MAAA,CAAOS,iBAAiB;EAExE,IAAIF,OAAA,KAAY,MAAM;IACpB,MAAMd,IAAA,GAAOS,aAAA,GAAgB,IAAAQ,KAAA,CAAAC,YAAY,EAACJ,OAAA,IAAWK,SAAA;IACrD,IAAIvB,gBAAA,CAAiBE,GAAA,EAAKC,GAAA,EAAKC,IAAA,GAAO;MACpC;IACF;EACF;EAEA,IAAI,CAACD,GAAA,CAAIqB,SAAS,CAAC,iBAAiB;IAClCrB,GAAA,CAAIE,SAAS,CACX,gBACAM,MAAA,CAAOc,WAAW,GACdd,MAAA,CAAOc,WAAW,GAClBb,IAAA,KAAS,QACTc,iBAAA,CAAAC,uBAAuB,GACvBf,IAAA,KAAS,SACT,qBACA;EAER;EAEA,IAAIM,OAAA,EAAS;IACXf,GAAA,CAAIE,SAAS,CAAC,kBAAkBuB,MAAA,CAAOC,UAAU,CAACX,OAAA;EACpD;EAEA,IAAIhB,GAAA,CAAI4B,MAAM,KAAK,QAAQ;IACzB3B,GAAA,CAAIO,GAAG,CAAC;EACV,OAAO,IAAIQ,OAAA,KAAY,MAAM;IAC3Bf,GAAA,CAAIO,GAAG,CAACQ,OAAA;EACV,OAAO;IACL,MAAMP,MAAA,CAAOoB,IAAI,CAAC5B,GAAA;EACpB;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}