{"ast":null,"code":"// TODO: Remove this file when Node.js 16 is not supported anymore\n\"use strict\";\n\nif (typeof fetch === \"undefined\" && typeof globalThis.fetch === \"undefined\") {\n  function getFetchImpl() {\n    return require(\"next/dist/compiled/undici\");\n  }\n  function getRequestImpl() {\n    const OriginalRequest = getFetchImpl().Request;\n    return class extends OriginalRequest {\n      constructor(input, init) {\n        super(input, init);\n        this.next = init == null ? void 0 : init.next;\n      }\n    };\n  }\n  // Due to limitation of global configuration, we have to do this resolution at runtime\n  globalThis.fetch = (...args) => {\n    var _global___NEXT_HTTP_AGENT_OPTIONS;\n    const fetchImpl = getFetchImpl();\n    // Undici does not support the `keepAlive` option,\n    // instead we have to pass a custom dispatcher\n    if (!((_global___NEXT_HTTP_AGENT_OPTIONS = global.__NEXT_HTTP_AGENT_OPTIONS) == null ? void 0 : _global___NEXT_HTTP_AGENT_OPTIONS.keepAlive) && !global.__NEXT_UNDICI_AGENT_SET) {\n      global.__NEXT_UNDICI_AGENT_SET = true;\n      fetchImpl.setGlobalDispatcher(new fetchImpl.Agent({\n        pipelining: 0\n      }));\n      console.warn('Warning - Configuring `keepAlive: false` is deprecated. Use `{ headers: { connection: \"close\" } }` instead.');\n    }\n    return fetchImpl.fetch(...args);\n  };\n  Object.defineProperties(global, {\n    Headers: {\n      get() {\n        return getFetchImpl().Headers;\n      }\n    },\n    Request: {\n      get() {\n        return getRequestImpl();\n      }\n    },\n    Response: {\n      get() {\n        return getFetchImpl().Response;\n      }\n    }\n  });\n}","map":{"version":3,"names":["fetch","globalThis","getFetchImpl","require","getRequestImpl","OriginalRequest","Request","constructor","input","init","next","args","_global___NEXT_HTTP_AGENT_OPTIONS","fetchImpl","global","__NEXT_HTTP_AGENT_OPTIONS","keepAlive","__NEXT_UNDICI_AGENT_SET","setGlobalDispatcher","Agent","pipelining","console","warn","Object","defineProperties","Headers","get","Response"],"sources":["../../src/server/node-polyfill-fetch.ts"],"sourcesContent":[null],"mappings":"AAAA;;;AAEA,IAAI,OAAOA,KAAA,KAAU,eAAe,OAAOC,UAAA,CAAWD,KAAK,KAAK,aAAa;EAC3E,SAASE,aAAA;IACP,OAAOC,OAAA,CAAQ;EACjB;EAEA,SAASC,eAAA;IACP,MAAMC,eAAA,GAAkBH,YAAA,GAAeI,OAAO;IAC9C,OAAO,cAAcD,eAAA;MACnBE,YAAYC,KAAwB,EAAEC,IAAiB,EAAE;QACvD,KAAK,CAACD,KAAA,EAAOC,IAAA;QACb,IAAI,CAACC,IAAI,GAAGD,IAAA,oBAAAA,IAAA,CAAMC,IAAI;MACxB;IACF;EACF;EAEA;EACAT,UAAA,CAAWD,KAAK,GAAG,CAAC,GAAGW,IAAA;QAMlBC,iCAAA;IALH,MAAMC,SAAA,GAAYX,YAAA;IAElB;IACA;IACA,IACE,GAACU,iCAAA,GAAAE,MAAA,CAAOC,yBAAyB,qBAAhCH,iCAAA,CAAkCI,SAAS,KAC5C,CAACF,MAAA,CAAOG,uBAAuB,EAC/B;MACAH,MAAA,CAAOG,uBAAuB,GAAG;MACjCJ,SAAA,CAAUK,mBAAmB,CAAC,IAAIL,SAAA,CAAUM,KAAK,CAAC;QAAEC,UAAA,EAAY;MAAE;MAClEC,OAAA,CAAQC,IAAI,CACV;IAEJ;IACA,OAAOT,SAAA,CAAUb,KAAK,IAAIW,IAAA;EAC5B;EAEAY,MAAA,CAAOC,gBAAgB,CAACV,MAAA,EAAQ;IAC9BW,OAAA,EAAS;MACPC,IAAA;QACE,OAAOxB,YAAA,GAAeuB,OAAO;MAC/B;IACF;IACAnB,OAAA,EAAS;MACPoB,IAAA;QACE,OAAOtB,cAAA;MACT;IACF;IACAuB,QAAA,EAAU;MACRD,IAAA;QACE,OAAOxB,YAAA,GAAeyB,QAAQ;MAChC;IACF;EACF;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}