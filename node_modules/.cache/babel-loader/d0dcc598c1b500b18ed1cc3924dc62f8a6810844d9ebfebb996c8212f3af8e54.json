{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n0 && (module.exports = {\n  encryptWithSecret: null,\n  decryptWithSecret: null\n});\nfunction _export(target, all) {\n  for (var name in all) Object.defineProperty(target, name, {\n    enumerable: true,\n    get: all[name]\n  });\n}\n_export(exports, {\n  encryptWithSecret: function () {\n    return encryptWithSecret;\n  },\n  decryptWithSecret: function () {\n    return decryptWithSecret;\n  }\n});\nconst _crypto = /*#__PURE__*/_interop_require_default(require(\"crypto\"));\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n// Background:\n// https://security.stackexchange.com/questions/184305/why-would-i-ever-use-aes-256-cbc-if-aes-256-gcm-is-more-secure\nconst CIPHER_ALGORITHM = `aes-256-gcm`,\n  CIPHER_KEY_LENGTH = 32,\n  CIPHER_IV_LENGTH = 16,\n  CIPHER_TAG_LENGTH = 16,\n  CIPHER_SALT_LENGTH = 64;\nconst PBKDF2_ITERATIONS = 100000 // https://support.1password.com/pbkdf2/\n;\n\nfunction encryptWithSecret(secret, data) {\n  const iv = _crypto.default.randomBytes(CIPHER_IV_LENGTH);\n  const salt = _crypto.default.randomBytes(CIPHER_SALT_LENGTH);\n  // https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2sync_password_salt_iterations_keylen_digest\n  const key = _crypto.default.pbkdf2Sync(secret, salt, PBKDF2_ITERATIONS, CIPHER_KEY_LENGTH, `sha512`);\n  const cipher = _crypto.default.createCipheriv(CIPHER_ALGORITHM, key, iv);\n  const encrypted = Buffer.concat([cipher.update(data, `utf8`), cipher.final()]);\n  // https://nodejs.org/api/crypto.html#crypto_cipher_getauthtag\n  const tag = cipher.getAuthTag();\n  return Buffer.concat([\n  // Data as required by:\n  // Salt for Key: https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2sync_password_salt_iterations_keylen_digest\n  // IV: https://nodejs.org/api/crypto.html#crypto_class_decipher\n  // Tag: https://nodejs.org/api/crypto.html#crypto_decipher_setauthtag_buffer\n  salt, iv, tag, encrypted]).toString(`hex`);\n}\nfunction decryptWithSecret(secret, encryptedData) {\n  const buffer = Buffer.from(encryptedData, `hex`);\n  const salt = buffer.slice(0, CIPHER_SALT_LENGTH);\n  const iv = buffer.slice(CIPHER_SALT_LENGTH, CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH);\n  const tag = buffer.slice(CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH, CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH + CIPHER_TAG_LENGTH);\n  const encrypted = buffer.slice(CIPHER_SALT_LENGTH + CIPHER_IV_LENGTH + CIPHER_TAG_LENGTH);\n  // https://nodejs.org/api/crypto.html#crypto_crypto_pbkdf2sync_password_salt_iterations_keylen_digest\n  const key = _crypto.default.pbkdf2Sync(secret, salt, PBKDF2_ITERATIONS, CIPHER_KEY_LENGTH, `sha512`);\n  const decipher = _crypto.default.createDecipheriv(CIPHER_ALGORITHM, key, iv);\n  decipher.setAuthTag(tag);\n  return decipher.update(encrypted) + decipher.final(`utf8`);\n}","map":{"version":3,"names":["encryptWithSecret","decryptWithSecret","CIPHER_ALGORITHM","CIPHER_KEY_LENGTH","CIPHER_IV_LENGTH","CIPHER_TAG_LENGTH","CIPHER_SALT_LENGTH","PBKDF2_ITERATIONS","secret","data","iv","_crypto","default","randomBytes","salt","key","pbkdf2Sync","cipher","createCipheriv","encrypted","Buffer","concat","update","final","tag","getAuthTag","toString","encryptedData","buffer","from","slice","decipher","createDecipheriv","setAuthTag"],"sources":["../../src/server/crypto-utils.ts"],"sourcesContent":[null],"mappings":";;;;;;;;;;;;;;;;EAagBA,iBAAiB,WAAAA,CAAA;WAAjBA,iBAAA;;EA+BAC,iBAAiB,WAAAA,CAAA;WAAjBA,iBAAA;;;8DA5CG;;;;;;AAEnB;AACA;AAEA,MAAMC,gBAAA,GAAoB,aAAY;EACpCC,iBAAA,GAAoB;EACpBC,gBAAA,GAAmB;EACnBC,iBAAA,GAAoB;EACpBC,kBAAA,GAAqB;AAEvB,MAAMC,iBAAA,GAAoB,OAAQ;AAAA;;AAE3B,SAASP,kBAAkBQ,MAAc,EAAEC,IAAY;EAC5D,MAAMC,EAAA,GAAKC,OAAA,CAAAC,OAAM,CAACC,WAAW,CAACT,gBAAA;EAC9B,MAAMU,IAAA,GAAOH,OAAA,CAAAC,OAAM,CAACC,WAAW,CAACP,kBAAA;EAEhC;EACA,MAAMS,GAAA,GAAMJ,OAAA,CAAAC,OAAM,CAACI,UAAU,CAC3BR,MAAA,EACAM,IAAA,EACAP,iBAAA,EACAJ,iBAAA,EACC,QAAO;EAGV,MAAMc,MAAA,GAASN,OAAA,CAAAC,OAAM,CAACM,cAAc,CAAChB,gBAAA,EAAkBa,GAAA,EAAKL,EAAA;EAC5D,MAAMS,SAAA,GAAYC,MAAA,CAAOC,MAAM,CAAC,CAACJ,MAAA,CAAOK,MAAM,CAACb,IAAA,EAAO,MAAK,GAAGQ,MAAA,CAAOM,KAAK,GAAG;EAE7E;EACA,MAAMC,GAAA,GAAMP,MAAA,CAAOQ,UAAU;EAE7B,OAAOL,MAAA,CAAOC,MAAM,CAAC;EACnB;EACA;EACA;EACA;EACAP,IAAA,EACAJ,EAAA,EACAc,GAAA,EACAL,SAAA,CACD,EAAEO,QAAQ,CAAE,KAAI;AACnB;AAEO,SAASzB,kBACdO,MAAc,EACdmB,aAAqB;EAErB,MAAMC,MAAA,GAASR,MAAA,CAAOS,IAAI,CAACF,aAAA,EAAgB,KAAI;EAE/C,MAAMb,IAAA,GAAOc,MAAA,CAAOE,KAAK,CAAC,GAAGxB,kBAAA;EAC7B,MAAMI,EAAA,GAAKkB,MAAA,CAAOE,KAAK,CACrBxB,kBAAA,EACAA,kBAAA,GAAqBF,gBAAA;EAEvB,MAAMoB,GAAA,GAAMI,MAAA,CAAOE,KAAK,CACtBxB,kBAAA,GAAqBF,gBAAA,EACrBE,kBAAA,GAAqBF,gBAAA,GAAmBC,iBAAA;EAE1C,MAAMc,SAAA,GAAYS,MAAA,CAAOE,KAAK,CAC5BxB,kBAAA,GAAqBF,gBAAA,GAAmBC,iBAAA;EAG1C;EACA,MAAMU,GAAA,GAAMJ,OAAA,CAAAC,OAAM,CAACI,UAAU,CAC3BR,MAAA,EACAM,IAAA,EACAP,iBAAA,EACAJ,iBAAA,EACC,QAAO;EAGV,MAAM4B,QAAA,GAAWpB,OAAA,CAAAC,OAAM,CAACoB,gBAAgB,CAAC9B,gBAAA,EAAkBa,GAAA,EAAKL,EAAA;EAChEqB,QAAA,CAASE,UAAU,CAACT,GAAA;EAEpB,OAAOO,QAAA,CAAST,MAAM,CAACH,SAAA,IAAaY,QAAA,CAASR,KAAK,CAAE,MAAK;AAC3D"},"metadata":{},"sourceType":"script","externalDependencies":[]}