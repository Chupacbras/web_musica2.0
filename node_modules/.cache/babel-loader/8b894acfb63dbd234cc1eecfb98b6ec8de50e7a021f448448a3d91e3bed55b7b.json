{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"runCompiler\", {\n  enumerable: true,\n  get: function () {\n    return runCompiler;\n  }\n});\nconst _webpack = require(\"next/dist/compiled/webpack/webpack\");\nfunction generateStats(result, stat) {\n  const {\n    errors,\n    warnings\n  } = stat.toJson({\n    preset: \"errors-warnings\",\n    moduleTrace: true\n  });\n  if (errors && errors.length > 0) {\n    result.errors.push(...errors);\n  }\n  if (warnings && warnings.length > 0) {\n    result.warnings.push(...warnings);\n  }\n  return result;\n}\n// Webpack 5 requires the compiler to be closed (to save caches)\n// Webpack 4 does not have this close method so in order to be backwards compatible we check if it exists\nfunction closeCompiler(compiler) {\n  return new Promise((resolve, reject) => {\n    // @ts-ignore Close only exists on the compiler in webpack 5\n    return compiler.close(err => err ? reject(err) : resolve());\n  });\n}\nfunction runCompiler(config, {\n  runWebpackSpan,\n  inputFileSystem\n}) {\n  return new Promise((resolve, reject) => {\n    const compiler = (0, _webpack.webpack)(config);\n    // Ensure we use the previous inputFileSystem\n    if (inputFileSystem) {\n      compiler.inputFileSystem = inputFileSystem;\n    }\n    compiler.fsStartTime = Date.now();\n    compiler.run((err, stats) => {\n      const webpackCloseSpan = runWebpackSpan.traceChild(\"webpack-close\", {\n        name: config.name\n      });\n      webpackCloseSpan.traceAsyncFn(() => closeCompiler(compiler)).then(() => {\n        if (err) {\n          const reason = err.stack ?? err.toString();\n          if (reason) {\n            return resolve([{\n              errors: [{\n                message: reason,\n                details: err.details\n              }],\n              warnings: [],\n              stats\n            }, compiler.inputFileSystem]);\n          }\n          return reject(err);\n        } else if (!stats) throw new Error(\"No Stats from webpack\");\n        const result = webpackCloseSpan.traceChild(\"webpack-generate-error-stats\").traceFn(() => generateStats({\n          errors: [],\n          warnings: [],\n          stats\n        }, stats));\n        return resolve([result, compiler.inputFileSystem]);\n      });\n    });\n  });\n}","map":{"version":3,"names":["runCompiler","generateStats","result","stat","errors","warnings","toJson","preset","moduleTrace","length","push","closeCompiler","compiler","Promise","resolve","reject","close","err","config","runWebpackSpan","inputFileSystem","_webpack","webpack","fsStartTime","Date","now","run","stats","webpackCloseSpan","traceChild","name","traceAsyncFn","then","reason","stack","toString","message","details","Error","traceFn"],"sources":["../../src/build/compiler.ts"],"sourcesContent":[null],"mappings":";;;;;+BAqCgB;;;WAAAA,WAAA;;;yBArCQ;AASxB,SAASC,cACPC,MAAsB,EACtBC,IAAmB;EAEnB,MAAM;IAAEC,MAAM;IAAEC;EAAQ,CAAE,GAAGF,IAAA,CAAKG,MAAM,CAAC;IACvCC,MAAA,EAAQ;IACRC,WAAA,EAAa;EACf;EACA,IAAIJ,MAAA,IAAUA,MAAA,CAAOK,MAAM,GAAG,GAAG;IAC/BP,MAAA,CAAOE,MAAM,CAACM,IAAI,IAAIN,MAAA;EACxB;EAEA,IAAIC,QAAA,IAAYA,QAAA,CAASI,MAAM,GAAG,GAAG;IACnCP,MAAA,CAAOG,QAAQ,CAACK,IAAI,IAAIL,QAAA;EAC1B;EAEA,OAAOH,MAAA;AACT;AAEA;AACA;AACA,SAASS,cAAcC,QAAkD;EACvE,OAAO,IAAIC,OAAA,CAAc,CAACC,OAAA,EAASC,MAAA;IACjC;IACA,OAAOH,QAAA,CAASI,KAAK,CAAEC,GAAA,IAAcA,GAAA,GAAMF,MAAA,CAAOE,GAAA,IAAOH,OAAA;EAC3D;AACF;AAEO,SAASd,YACdkB,MAA6B,EAC7B;EACEC,cAAc;EACdC;AAAe,CACiC;EAElD,OAAO,IAAIP,OAAA,CAAQ,CAACC,OAAA,EAASC,MAAA;IAC3B,MAAMH,QAAA,GAAW,IAAAS,QAAA,CAAAC,OAAO,EAACJ,MAAA;IACzB;IACA,IAAIE,eAAA,EAAiB;MACnBR,QAAA,CAASQ,eAAe,GAAGA,eAAA;IAC7B;IACAR,QAAA,CAASW,WAAW,GAAGC,IAAA,CAAKC,GAAG;IAC/Bb,QAAA,CAASc,GAAG,CAAC,CAACT,GAAA,EAAKU,KAAA;MACjB,MAAMC,gBAAA,GAAmBT,cAAA,CAAeU,UAAU,CAAC,iBAAiB;QAClEC,IAAA,EAAMZ,MAAA,CAAOY;MACf;MACAF,gBAAA,CACGG,YAAY,CAAC,MAAMpB,aAAA,CAAcC,QAAA,GACjCoB,IAAI,CAAC;QACJ,IAAIf,GAAA,EAAK;UACP,MAAMgB,MAAA,GAAShB,GAAA,CAAIiB,KAAK,IAAIjB,GAAA,CAAIkB,QAAQ;UACxC,IAAIF,MAAA,EAAQ;YACV,OAAOnB,OAAA,CAAQ,CACb;cACEV,MAAA,EAAQ,CAAC;gBAAEgC,OAAA,EAASH,MAAA;gBAAQI,OAAA,EAASpB,GAAC,CAAYoB;cAAQ,EAAE;cAC5DhC,QAAA,EAAU,EAAE;cACZsB;YACF,GACAf,QAAA,CAASQ,eAAe,CACzB;UACH;UACA,OAAOL,MAAA,CAAOE,GAAA;QAChB,OAAO,IAAI,CAACU,KAAA,EAAO,MAAM,IAAIW,KAAA,CAAM;QAEnC,MAAMpC,MAAA,GAAS0B,gBAAA,CACZC,UAAU,CAAC,gCACXU,OAAO,CAAC,MACPtC,aAAA,CAAc;UAAEG,MAAA,EAAQ,EAAE;UAAEC,QAAA,EAAU,EAAE;UAAEsB;QAAM,GAAGA,KAAA;QAEvD,OAAOb,OAAA,CAAQ,CAACZ,MAAA,EAAQU,QAAA,CAASQ,eAAe,CAAC;MACnD;IACJ;EACF;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}