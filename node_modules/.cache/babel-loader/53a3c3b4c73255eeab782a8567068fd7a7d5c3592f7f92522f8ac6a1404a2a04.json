{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"proxyRequest\", {\n  enumerable: true,\n  get: function () {\n    return proxyRequest;\n  }\n});\nconst _cookies = require(\"next/dist/compiled/@edge-runtime/cookies\");\nconst _nexturl = require(\"../../../../web/next-url\");\nconst _cleanurl = require(\"./clean-url\");\nfunction proxyRequest(request, {\n  dynamic\n}, hooks) {\n  function handleNextUrlBailout(prop) {\n    switch (prop) {\n      case \"search\":\n      case \"searchParams\":\n      case \"toString\":\n      case \"href\":\n      case \"origin\":\n        hooks.staticGenerationBailout(`nextUrl.${prop}`);\n        return;\n      default:\n        return;\n    }\n  }\n  const cache = {};\n  const handleForceStatic = (url, prop) => {\n    switch (prop) {\n      case \"search\":\n        return \"\";\n      case \"searchParams\":\n        if (!cache.searchParams) cache.searchParams = new URLSearchParams();\n        return cache.searchParams;\n      case \"url\":\n      case \"href\":\n        if (!cache.url) cache.url = (0, _cleanurl.cleanURL)(url);\n        return cache.url;\n      case \"toJSON\":\n      case \"toString\":\n        if (!cache.url) cache.url = (0, _cleanurl.cleanURL)(url);\n        if (!cache.toString) cache.toString = () => cache.url;\n        return cache.toString;\n      case \"headers\":\n        if (!cache.headers) cache.headers = new Headers();\n        return cache.headers;\n      case \"cookies\":\n        if (!cache.headers) cache.headers = new Headers();\n        if (!cache.cookies) cache.cookies = new _cookies.RequestCookies(cache.headers);\n        return cache.cookies;\n      case \"clone\":\n        if (!cache.url) cache.url = (0, _cleanurl.cleanURL)(url);\n        return () => new _nexturl.NextURL(cache.url);\n      default:\n        break;\n    }\n  };\n  const wrappedNextUrl = new Proxy(request.nextUrl, {\n    get(target, prop) {\n      handleNextUrlBailout(prop);\n      if (dynamic === \"force-static\" && typeof prop === \"string\") {\n        const result = handleForceStatic(target.href, prop);\n        if (result !== undefined) return result;\n      }\n      const value = target[prop];\n      if (typeof value === \"function\") {\n        return value.bind(target);\n      }\n      return value;\n    },\n    set(target, prop, value) {\n      handleNextUrlBailout(prop);\n      target[prop] = value;\n      return true;\n    }\n  });\n  const handleReqBailout = prop => {\n    switch (prop) {\n      case \"headers\":\n        hooks.headerHooks.headers();\n        return;\n      // if request.url is accessed directly instead of\n      // request.nextUrl we bail since it includes query\n      // values that can be relied on dynamically\n      case \"url\":\n      case \"body\":\n      case \"blob\":\n      case \"json\":\n      case \"text\":\n      case \"arrayBuffer\":\n      case \"formData\":\n        hooks.staticGenerationBailout(`request.${prop}`);\n        return;\n      default:\n        return;\n    }\n  };\n  return new Proxy(request, {\n    get(target, prop) {\n      handleReqBailout(prop);\n      if (prop === \"nextUrl\") {\n        return wrappedNextUrl;\n      }\n      if (dynamic === \"force-static\" && typeof prop === \"string\") {\n        const result = handleForceStatic(target.url, prop);\n        if (result !== undefined) return result;\n      }\n      const value = target[prop];\n      if (typeof value === \"function\") {\n        return value.bind(target);\n      }\n      return value;\n    },\n    set(target, prop, value) {\n      handleReqBailout(prop);\n      target[prop] = value;\n      return true;\n    }\n  });\n}","map":{"version":3,"names":["proxyRequest","request","dynamic","hooks","handleNextUrlBailout","prop","staticGenerationBailout","cache","handleForceStatic","url","searchParams","URLSearchParams","_cleanurl","cleanURL","toString","headers","Headers","cookies","_cookies","RequestCookies","_nexturl","NextURL","wrappedNextUrl","Proxy","nextUrl","get","target","result","href","undefined","value","bind","set","handleReqBailout","headerHooks"],"sources":["../../../../../../src/server/future/route-modules/app-route/helpers/proxy-request.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}