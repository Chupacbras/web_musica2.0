{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"fetchInlineAsset\", {\n  enumerable: true,\n  get: function () {\n    return fetchInlineAsset;\n  }\n});\nconst _fs = require(\"fs\");\nconst _bodystreams = require(\"../../body-streams\");\nconst _path = require(\"path\");\nasync function fetchInlineAsset(options) {\n  var _options_assets;\n  const inputString = String(options.input);\n  if (!inputString.startsWith(\"blob:\")) {\n    return;\n  }\n  const hash = inputString.replace(\"blob:\", \"\");\n  const asset = (_options_assets = options.assets) == null ? void 0 : _options_assets.find(x => x.name === hash);\n  if (!asset) {\n    return;\n  }\n  const filePath = (0, _path.resolve)(options.distDir, asset.filePath);\n  const fileIsReadable = await _fs.promises.access(filePath).then(() => true, () => false);\n  if (fileIsReadable) {\n    const readStream = (0, _fs.createReadStream)(filePath);\n    return new options.context.Response((0, _bodystreams.requestToBodyStream)(options.context, Uint8Array, readStream));\n  }\n}","map":{"version":3,"names":["fetchInlineAsset","options","_options_assets","inputString","String","input","startsWith","hash","replace","asset","assets","find","x","name","filePath","_path","resolve","distDir","fileIsReadable","_fs","promises","access","then","readStream","createReadStream","context","Response","_bodystreams","requestToBodyStream","Uint8Array"],"sources":["../../../../src/server/web/sandbox/fetch-inline-assets.ts"],"sourcesContent":[null],"mappings":";;;;;+BAUsB;;;WAAAA,gBAAA;;;oBAT2B;6BACb;sBACZ;AAOjB,eAAeA,iBAAiBC,OAKtC;MAOeC,eAAA;EANd,MAAMC,WAAA,GAAcC,MAAA,CAAOH,OAAA,CAAQI,KAAK;EACxC,IAAI,CAACF,WAAA,CAAYG,UAAU,CAAC,UAAU;IACpC;EACF;EAEA,MAAMC,IAAA,GAAOJ,WAAA,CAAYK,OAAO,CAAC,SAAS;EAC1C,MAAMC,KAAA,IAAQP,eAAA,GAAAD,OAAA,CAAQS,MAAM,qBAAdR,eAAA,CAAgBS,IAAI,CAAEC,CAAA,IAAMA,CAAA,CAAEC,IAAI,KAAKN,IAAA;EACrD,IAAI,CAACE,KAAA,EAAO;IACV;EACF;EAEA,MAAMK,QAAA,GAAW,IAAAC,KAAA,CAAAC,OAAO,EAACf,OAAA,CAAQgB,OAAO,EAAER,KAAA,CAAMK,QAAQ;EACxD,MAAMI,cAAA,GAAiB,MAAMC,GAAA,CAAAC,QAAE,CAACC,MAAM,CAACP,QAAA,EAAUQ,IAAI,CACnD,MAAM,MACN,MAAM;EAGR,IAAIJ,cAAA,EAAgB;IAClB,MAAMK,UAAA,GAAa,IAAAJ,GAAA,CAAAK,gBAAgB,EAACV,QAAA;IACpC,OAAO,IAAIb,OAAA,CAAQwB,OAAO,CAACC,QAAQ,CACjC,IAAAC,YAAA,CAAAC,mBAAmB,EAAC3B,OAAA,CAAQwB,OAAO,EAAEI,UAAA,EAAYN,UAAA;EAErD;AACF"},"metadata":{},"sourceType":"script","externalDependencies":[]}