{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"getPostCssPlugins\", {\n  enumerable: true,\n  get: function () {\n    return getPostCssPlugins;\n  }\n});\nconst _chalk = /*#__PURE__*/_interop_require_default(require(\"next/dist/compiled/chalk\"));\nconst _findconfig = require(\"../../../../../lib/find-config\");\nfunction _interop_require_default(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\nconst genericErrorText = \"Malformed PostCSS Configuration\";\nfunction getError_NullConfig(pluginName) {\n  return `${_chalk.default.red.bold(\"Error\")}: Your PostCSS configuration for '${pluginName}' cannot have ${_chalk.default.bold(\"null\")} configuration.\\nTo disable '${pluginName}', pass ${_chalk.default.bold(\"false\")}, otherwise, pass ${_chalk.default.bold(\"true\")} or a configuration object.`;\n}\nfunction isIgnoredPlugin(pluginPath) {\n  const ignoredRegex = /(?:^|[\\\\/])(postcss-modules-values|postcss-modules-scope|postcss-modules-extract-imports|postcss-modules-local-by-default|postcss-modules)(?:[\\\\/]|$)/i;\n  const match = ignoredRegex.exec(pluginPath);\n  if (match == null) {\n    return false;\n  }\n  const plugin = match.pop();\n  console.warn(`${_chalk.default.yellow.bold(\"Warning\")}: Please remove the ${_chalk.default.underline(plugin)} plugin from your PostCSS configuration. ` + `This plugin is automatically configured by Next.js.\\n` + \"Read more: https://nextjs.org/docs/messages/postcss-ignored-plugin\");\n  return true;\n}\nconst createLazyPostCssPlugin = fn => {\n  let result = undefined;\n  const plugin = (...args) => {\n    if (result === undefined) result = fn();\n    if (result.postcss === true) {\n      return result(...args);\n    } else if (result.postcss) {\n      return result.postcss;\n    }\n    return result;\n  };\n  plugin.postcss = true;\n  return plugin;\n};\nasync function loadPlugin(dir, pluginName, options) {\n  if (options === false || isIgnoredPlugin(pluginName)) {\n    return false;\n  }\n  if (options == null) {\n    console.error(getError_NullConfig(pluginName));\n    throw new Error(genericErrorText);\n  }\n  const pluginPath = require.resolve(pluginName, {\n    paths: [dir]\n  });\n  if (isIgnoredPlugin(pluginPath)) {\n    return false;\n  } else if (options === true) {\n    return createLazyPostCssPlugin(() => require(pluginPath));\n  } else {\n    if (typeof options === \"object\" && Object.keys(options).length === 0) {\n      return createLazyPostCssPlugin(() => require(pluginPath));\n    }\n    return createLazyPostCssPlugin(() => require(pluginPath)(options));\n  }\n}\nfunction getDefaultPlugins(supportedBrowsers, disablePostcssPresetEnv) {\n  return [require.resolve(\"next/dist/compiled/postcss-flexbugs-fixes\"), disablePostcssPresetEnv ? false : [require.resolve(\"next/dist/compiled/postcss-preset-env\"), {\n    browsers: supportedBrowsers ?? [\"defaults\"],\n    autoprefixer: {\n      // Disable legacy flexbox support\n      flexbox: \"no-2009\"\n    },\n    // Enable CSS features that have shipped to the\n    // web platform, i.e. in 2+ browsers unflagged.\n    stage: 3,\n    features: {\n      \"custom-properties\": false\n    }\n  }]].filter(Boolean);\n}\nasync function getPostCssPlugins(dir, supportedBrowsers, disablePostcssPresetEnv = false) {\n  let config = await (0, _findconfig.findConfig)(dir, \"postcss\");\n  if (config == null) {\n    config = {\n      plugins: getDefaultPlugins(supportedBrowsers, disablePostcssPresetEnv)\n    };\n  }\n  if (typeof config === \"function\") {\n    throw new Error(`Your custom PostCSS configuration may not export a function. Please export a plain object instead.\\n` + \"Read more: https://nextjs.org/docs/messages/postcss-function\");\n  }\n  // Warn user about configuration keys which are not respected\n  const invalidKey = Object.keys(config).find(key => key !== \"plugins\");\n  if (invalidKey) {\n    console.warn(`${_chalk.default.yellow.bold(\"Warning\")}: Your PostCSS configuration defines a field which is not supported (\\`${invalidKey}\\`). ` + `Please remove this configuration value.`);\n  }\n  // Enforce the user provided plugins if the configuration file is present\n  let plugins = config.plugins;\n  if (plugins == null || typeof plugins !== \"object\") {\n    throw new Error(`Your custom PostCSS configuration must export a \\`plugins\\` key.`);\n  }\n  if (!Array.isArray(plugins)) {\n    // Capture variable so TypeScript is happy\n    const pc = plugins;\n    plugins = Object.keys(plugins).reduce((acc, curr) => {\n      const p = pc[curr];\n      if (typeof p === \"undefined\") {\n        console.error(getError_NullConfig(curr));\n        throw new Error(genericErrorText);\n      }\n      acc.push([curr, p]);\n      return acc;\n    }, []);\n  }\n  const parsed = [];\n  plugins.forEach(plugin => {\n    if (plugin == null) {\n      console.warn(`${_chalk.default.yellow.bold(\"Warning\")}: A ${_chalk.default.bold(\"null\")} PostCSS plugin was provided. This entry will be ignored.`);\n    } else if (typeof plugin === \"string\") {\n      parsed.push([plugin, true]);\n    } else if (Array.isArray(plugin)) {\n      const pluginName = plugin[0];\n      const pluginConfig = plugin[1];\n      if (typeof pluginName === \"string\" && (typeof pluginConfig === \"boolean\" || typeof pluginConfig === \"object\" || typeof pluginConfig === \"string\")) {\n        parsed.push([pluginName, pluginConfig]);\n      } else {\n        if (typeof pluginName !== \"string\") {\n          console.error(`${_chalk.default.red.bold(\"Error\")}: A PostCSS Plugin must be provided as a ${_chalk.default.bold(\"string\")}. Instead, we got: '${pluginName}'.\\n` + \"Read more: https://nextjs.org/docs/messages/postcss-shape\");\n        } else {\n          console.error(`${_chalk.default.red.bold(\"Error\")}: A PostCSS Plugin was passed as an array but did not provide its configuration ('${pluginName}').\\n` + \"Read more: https://nextjs.org/docs/messages/postcss-shape\");\n        }\n        throw new Error(genericErrorText);\n      }\n    } else if (typeof plugin === \"function\") {\n      console.error(`${_chalk.default.red.bold(\"Error\")}: A PostCSS Plugin was passed as a function using require(), but it must be provided as a ${_chalk.default.bold(\"string\")}.\\nRead more: https://nextjs.org/docs/messages/postcss-shape`);\n      throw new Error(genericErrorText);\n    } else {\n      console.error(`${_chalk.default.red.bold(\"Error\")}: An unknown PostCSS plugin was provided (${plugin}).\\n` + \"Read more: https://nextjs.org/docs/messages/postcss-shape\");\n      throw new Error(genericErrorText);\n    }\n  });\n  const resolved = await Promise.all(parsed.map(p => loadPlugin(dir, p[0], p[1])));\n  const filtered = resolved.filter(Boolean);\n  return filtered;\n}","map":{"version":3,"names":["getPostCssPlugins","genericErrorText","getError_NullConfig","pluginName","_chalk","default","red","bold","isIgnoredPlugin","pluginPath","ignoredRegex","match","exec","plugin","pop","console","warn","yellow","underline","createLazyPostCssPlugin","fn","result","undefined","args","postcss","loadPlugin","dir","options","error","Error","require","resolve","paths","Object","keys","length","getDefaultPlugins","supportedBrowsers","disablePostcssPresetEnv","browsers","autoprefixer","flexbox","stage","features","filter","Boolean","config","_findconfig","findConfig","plugins","invalidKey","find","key","Array","isArray","pc","reduce","acc","curr","p","push","parsed","forEach","pluginConfig","resolved","Promise","all","map","filtered"],"sources":["../../../../../../src/build/webpack/config/blocks/css/plugins.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}